# å¿«é€Ÿå¼€å§‹

æˆ‘ä»¬ä»ä½¿ç”¨ç®€åŒ–ç‰ˆ Bakery schema çš„ [Seaography ç¤ºä¾‹](https://github.com/SeaQL/sea-orm/tree/master/examples/seaography_example) å¼€å§‹ã€‚

è¿˜æœ‰å…¶ä»–æ›´å¤æ‚ schema çš„ç¤ºä¾‹ï¼š

+ [Sakila](https://github.com/SeaQL/seaography/tree/main/examples/sqlite)
+ [AdventureWorks](https://github.com/SeaQL/sea-orm-pro)

![](https://raw.githubusercontent.com/SeaQL/sea-orm/master/examples/seaography_example/Seaography%20example.png)

è¦å¼€å§‹ä½¿ç”¨ï¼Œä½ åªéœ€è¦ä¸€ä¸ªå¸¦æœ‰ schema çš„å¯ç”¨ SQL æ•°æ®åº“ã€‚ä½ å¯ä»¥é€šè¿‡ç¼–å†™ SeaORM å®ä½“åœ¨ Rust ä¸­å®Œæˆæ‰€æœ‰å·¥ä½œï¼Œæˆ–ä½¿ç”¨ GUI å·¥å…·ï¼ˆä¾‹å¦‚ [DataGrip](https://www.jetbrains.com/datagrip/)ï¼‰è®¾è®¡ schemaã€‚

## å®‰è£… Seaography CLI

```sh
cargo install seaography-cli@^2.0.0-rc
```

## ç”Ÿæˆ Seaography å®ä½“

### Dense Entity æ ¼å¼

*å®Œå…¨ç›¸åŒçš„ã€é€å­—èŠ‚çš„* SeaORM å®ä½“å¯ä»¥åœ¨ Seaography ä¸­ä½¿ç”¨ã€‚é­”æ³•å‘ç”Ÿåœ¨ SeaORM å®çš„ `seaography` feature flag èƒŒåã€‚

```sh
sea-orm-cli generate entity --output-dir ./src/entities --entity-format dense
```

```rust title="src/entities/cake.rs"
//! `SeaORM` Entity, @generated by sea-orm-codegen 2.0.0-rc.14

use sea_orm::entity::prelude::*;

#[sea_orm::model]
#[derive(Clone, Debug, PartialEq, DeriveEntityModel, Eq)]
#[sea_orm(table_name = "cake")]
pub struct Model {
    #[sea_orm(primary_key)]
    pub id: i32,
    pub name: String,
    #[sea_orm(column_type = "Decimal(Some((16, 4)))")]
    pub price: Decimal,
    pub bakery_id: i32,
    pub gluten_free: bool,
    #[sea_orm(
        belongs_to,
        from = "bakery_id",
        to = "id",
        on_update = "Cascade",
        on_delete = "Cascade"
    )]
    pub bakery: HasOne<super::bakery::Entity>,
    #[sea_orm(has_many, via = "cake_baker")]
    pub bakers: HasMany<super::baker::Entity>,
}

impl ActiveModelBehavior for ActiveModel {}
```

### Compact Entity æ ¼å¼

```sh
sea-orm-cli generate entity --output-dir ./src/entities --entity-format compact --seaography
```

åƒå¾€å¸¸ä¸€æ ·ä½¿ç”¨ `sea-orm-cli` ç”Ÿæˆå®ä½“ï¼Œä½†éœ€è¦é¢å¤–æ·»åŠ  `--seaography` æ ‡å¿—ã€‚è¿™äº›å®ä½“åŸºæœ¬ä¸Šæ˜¯ç»å…¸çš„ SeaORM å®ä½“ï¼Œä½†å¤šäº†ä¸€ä¸ª `RelatedEntity` æšä¸¾ã€‚

```rust {24-30} title="src/entities/cake.rs"
//! `SeaORM` Entity, @generated by sea-orm-codegen 2.0.0-rc.12

use sea_orm::entity::prelude::*;

#[derive(Clone, Debug, PartialEq, DeriveEntityModel, Eq)]
#[sea_orm(table_name = "cake")]
pub struct Model {
    #[sea_orm(primary_key)]
    pub id: i32,
    pub name: String,
    #[sea_orm(column_type = "Decimal(Some((16, 4)))")]
    pub price: Decimal,
    pub bakery_id: i32,
    pub gluten_free: bool,
}

#[derive(Copy, Clone, Debug, EnumIter, DeriveRelation)]
pub enum Relation { .. }

impl Related<super::bakery::Entity> for Entity { .. }

impl ActiveModelBehavior for ActiveModel {}

#[derive(Copy, Clone, Debug, EnumIter, DeriveRelatedEntity)]
pub enum RelatedEntity {
    #[sea_orm(entity = "super::bakery::Entity")]
    Bakery,
    #[sea_orm(entity = "super::baker::Entity")]
    Baker,
}
```

## ç”Ÿæˆ GraphQL é¡¹ç›®

ç”Ÿæˆæ–°é¡¹ç›®æ˜¯å¯åŠ¨ GraphQL æœåŠ¡å™¨çš„æœ€ç®€å•æ–¹å¼ã€‚
ç„¶è€Œï¼ŒSeaography å¯ä»¥è½»æ¾é›†æˆåˆ°ä½¿ç”¨ä»»ä½• Web æ¡†æ¶æ„å»ºçš„ç°æœ‰ Web æœåŠ¡å™¨ä¸­ã€‚

Seaography å¼€ç®±å³ç”¨æ”¯æŒ Actixã€Axum å’Œ Poemã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```sh
seaography-cli --output-dir . --entities ./src/entities --framework axum sea-orm-seaography-example
```

å®Œæ•´å¸®åŠ©ï¼š

```sh
ğŸ§­ A GraphQL framework for SeaORM

Usage: seaography-cli [OPTIONS] --entities <ENTITIES> --database-url <DATABASE_URL> <CRATE_NAME>

Arguments:
  <CRATE_NAME>  Crate name for generated project

Options:
  -o, --output-dir <OUTPUT_DIR>
          Project output directory [default: ./]
  -e, --entities <ENTITIES>
          Entities directory
  -u, --database-url <DATABASE_URL>
          Database URL [env: DATABASE_URL]
  -f, --framework <FRAMEWORK>
          Which web framework to use [default: poem] [possible values: actix, poem, axum]
      --depth-limit <DEPTH_LIMIT>
          GraphQL depth limit
      --complexity-limit <COMPLEXITY_LIMIT>
          GraphQL complexity limit
  -h, --help
          Print help
  -V, --version
          Print version
```

## å¯åŠ¨æœåŠ¡å™¨

```sh
cd graphql
cargo run
```

ä½ å½“ç„¶å¯ä»¥è‡ªç”±ä¿®æ”¹é¡¹ç›®ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚
æœ‰è¶£çš„éƒ¨åˆ†ä» `query_root.rs` ä¸­çš„ `schema_builder` å‡½æ•°å¼€å§‹ã€‚
ä½ å¯ä»¥å‘ GraphQL schema æ·»åŠ è‡ªå®šä¹‰å®ä½“ã€æŸ¥è¯¢å’Œå˜æ›´ã€‚

## è¿è¡Œä¸€äº›æŸ¥è¯¢

```sh
Visit GraphQL Playground at http://localhost:8000
```

å¯¼èˆªåˆ° GraphQL Playgroundï¼Œç„¶åå¼€å§‹è¿è¡Œä¸€äº›æŸ¥è¯¢ï¼

### æŸ¥æ‰¾å·§å…‹åŠ›è›‹ç³•å¹¶çŸ¥é“åœ¨å“ªé‡Œè´­ä¹°

```graphql
{
  cake(filters: { name: { contains: "Chocolate" } }) {
    nodes {
      name
      price
      bakery {
        name
      }
    }
  }
}
```

### æŸ¥æ‰¾ Alice çƒ˜ç„™çš„æ‰€æœ‰è›‹ç³•

```graphql
{
  cake(having: { baker: { name: { eq: "Alice" } } }) {
    nodes {
      name
      price
      baker {
        nodes {
          name
        }
      }
    }
  }
}
```

### åˆ—å‡ºæ‰€æœ‰çƒ˜ç„™åº—åŠå…¶è›‹ç³•ï¼Œä»¥åŠçƒ˜ç„™å®ƒä»¬çš„é¢åŒ…å¸ˆ

```graphql
{
  bakery(pagination: { page: { limit: 10, page: 0 } }, orderBy: { name: ASC }) {
    nodes {
      name
      cake {
        nodes {
          name
          price
          baker {
            nodes {
              name
            }
          }
        }
      }
    }
  }
}
```

## ä¸‹ä¸€æ­¥

Seaography æ¶µç›–æ„å»ºå¤æ‚åº”ç”¨çš„æ‰€æœ‰éœ€æ±‚â€”â€”ä»æ•°æ®è®¿é—®ã€è®¿é—®æ§åˆ¶åˆ°[å‰ç«¯é›†æˆ](https://www.sea-ql.org/sea-orm-pro)ã€‚

åœ¨ [Seaography å®Œæ•´æ–‡æ¡£](https://www.sea-ql.org/Seaography/docs/index/) (è‹±æ–‡) ä¸­äº†è§£æ›´å¤šå…³äºæ·»åŠ è‡ªå®šä¹‰ GraphQL ç«¯ç‚¹å’Œè‡ªå®šä¹‰ resolver çš„å†…å®¹ã€‚
