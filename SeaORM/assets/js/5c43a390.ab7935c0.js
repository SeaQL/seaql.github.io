"use strict";(self.webpackChunksea_orm=self.webpackChunksea_orm||[]).push([[80855],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var o=t(96540);const a={},s=o.createContext(a);function r(e){const n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),o.createElement(s.Provider,{value:n},e.children)}},53124:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>u});const o=JSON.parse('{"id":"advanced-query/aggregate-function","title":"Aggregate Functions","description":"You can group results with the group_by method. If you wish to further restrict the grouped result set, the having method can be applied.","source":"@site/docs/08-advanced-query/03-aggregate-function.md","sourceDirName":"08-advanced-query","slug":"/advanced-query/aggregate-function","permalink":"/SeaORM/docs/advanced-query/aggregate-function","draft":false,"unlisted":false,"editUrl":"https://github.com/SeaQL/seaql.github.io/edit/master/SeaORM/docs/08-advanced-query/03-aggregate-function.md","tags":[],"version":"current","lastUpdatedBy":"Chris Tsang","lastUpdatedAt":1772314886000,"sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Conditional Expressions","permalink":"/SeaORM/docs/advanced-query/conditional-expression"},"next":{"title":"Custom Join Condition","permalink":"/SeaORM/docs/advanced-query/custom-join-condition"}}');var a=t(74848),s=t(28453);const r={},i="Aggregate Functions",c={},u=[{value:"Sum",id:"sum",level:2},{value:"Sum a single column",id:"sum-a-single-column",level:3},{value:"Sum with group by",id:"sum-with-group-by",level:3},{value:"Group By",id:"group-by",level:2},{value:"Using group by with aggregate functions",id:"using-group-by-with-aggregate-functions",level:3},{value:"Having",id:"having",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"aggregate-functions",children:"Aggregate Functions"})}),"\n",(0,a.jsxs)(n.p,{children:["You can group results with the ",(0,a.jsx)(n.code,{children:"group_by"})," method. If you wish to further restrict the grouped result set, the ",(0,a.jsx)(n.code,{children:"having"})," method can be applied."]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Aggregation functions including ",(0,a.jsx)(n.code,{children:"max"}),", ",(0,a.jsx)(n.code,{children:"min"}),", ",(0,a.jsx)(n.code,{children:"sum"}),", ",(0,a.jsx)(n.code,{children:"avg"}),", ",(0,a.jsx)(n.code,{children:"count"})," are available in ",(0,a.jsx)(n.a,{href:"https://docs.rs/sea-orm/2.0.0-rc.25/sea_orm/entity/trait.ColumnTrait.html",children:(0,a.jsx)(n.code,{children:"ColumnTrait"})}),"."]})}),"\n",(0,a.jsx)(n.h2,{id:"sum",children:"Sum"}),"\n",(0,a.jsx)(n.h3,{id:"sum-a-single-column",children:"Sum a single column"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'let sum_order_total: Decimal = order::Entity::find()\n    .select_only()\n    .column_as(order::Column::Total.sum(), "sum")\n    .into_tuple()\n    .one(db)\n    .await?\n    .unwrap();\n'})}),"\n",(0,a.jsx)(n.h3,{id:"sum-with-group-by",children:"Sum with group by"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'let (customer, total_spent): (String, Decimal) = customer::Entity::find()\n    .left_join(order::Entity)\n    .select_only()\n    .column(customer::Column::Name)\n    .column_as(order::Column::Total.sum(), "sum")\n    .group_by(customer::Column::Name)\n    .into_tuple()\n    .one(db)\n    .await?\n    .unwrap();\n\nassert_eq!(customer, "Kate");\nassert_eq!(total_spent, 25.into());\n'})}),"\n",(0,a.jsx)(n.h2,{id:"group-by",children:"Group By"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"group_by"})," method can take a column of the entity or a complex ",(0,a.jsx)(n.a,{href:"https://docs.rs/sea-query/*/sea_query/expr/enum.SimpleExpr.html",children:(0,a.jsx)(n.code,{children:"sea_query::SimpleExpr"})}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'assert_eq!(\n    cake::Entity::find()\n        .select_only()\n        .column(cake::Column::Name)\n        .group_by(cake::Column::Name)\n        .build(DbBackend::Postgres)\n        .to_string(),\n    r#"SELECT "cake"."name" FROM "cake" GROUP BY "cake"."name""#\n);\n\nassert_eq!(\n    cake::Entity::find()\n        .select_only()\n        .column_as(cake::Column::Id.count(), "count")\n        .column_as(cake::Column::Id.sum(), "sum_of_id")\n        .group_by(cake::Column::Name)\n        .build(DbBackend::Postgres)\n        .to_string(),\n    r#"SELECT COUNT("cake"."id") AS "count", SUM("cake"."id") AS "sum_of_id" FROM "cake" GROUP BY "cake"."name""#\n);\n'})}),"\n",(0,a.jsx)(n.h3,{id:"using-group-by-with-aggregate-functions",children:"Using group by with aggregate functions"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'#[derive(Debug, FromQueryResult)]\nstruct SelectResult {\n    name: String,\n    num_orders: i64,\n    total_spent: Decimal,\n    min_spent: Decimal,\n    max_spent: Decimal,\n}\n\nlet select = customer::Entity::find()\n    .left_join(order::Entity)\n    .select_only()\n    .column(customer::Column::Name)\n    .column_as(order::Column::Total.count(), "num_orders")\n    .column_as(order::Column::Total.sum(), "total_spent")\n    .column_as(order::Column::Total.min(), "min_spent")\n    .column_as(order::Column::Total.max(), "max_spent")\n    .order_by_asc(customer::Column::Name)\n    .group_by(customer::Column::Name);\n\nlet result: Option<SelectResult> = select\n    .into_model()\n    .one(&ctx.db)\n    .await?;\n'})}),"\n",(0,a.jsx)(n.h2,{id:"having",children:"Having"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"having"})," method can take any conditional expressions introduced in the previous section."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'assert_eq!(\n    cake::Entity::find()\n        .having(cake::Column::Id.eq(4))\n        .having(cake::Column::Id.eq(5))\n        .build(DbBackend::MySql)\n        .to_string(),\n    "SELECT `cake`.`id`, `cake`.`name` FROM `cake` HAVING `cake`.`id` = 4 AND `cake`.`id` = 5"\n);\n\nassert_eq!(\n    cake::Entity::find()\n        .select_only()\n        .column_as(cake::Column::Id.count(), "count")\n        .column_as(cake::Column::Id.sum(), "sum_of_id")\n        .group_by(cake::Column::Name)\n        .having(Expr::col("count").gt(6))\n        .build(DbBackend::MySql)\n        .to_string(),\n    "SELECT COUNT(`cake`.`id`) AS `count`, SUM(`cake`.`id`) AS `sum_of_id` FROM `cake` GROUP BY `cake`.`name` HAVING `count` > 6"\n);\n'})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);