"use strict";(self.webpackChunksea_orm=self.webpackChunksea_orm||[]).push([[33962],{74901:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"relation/chained-relations","title":"Chained Relations","description":"The Related trait is a representation of the arrows (1-1, 1-N, M-N) we draw on Entity Relationship Diagrams. A Linked is composed of a chain of relations, and is useful when:","source":"@site/versioned_docs/version-0.11.x/06-relation/04-chained-relations.md","sourceDirName":"06-relation","slug":"/relation/chained-relations","permalink":"/SeaORM/docs/0.11.x/relation/chained-relations","draft":false,"unlisted":false,"editUrl":"https://github.com/SeaQL/seaql.github.io/edit/master/SeaORM/versioned_docs/version-0.11.x/06-relation/04-chained-relations.md","tags":[],"version":"0.11.x","lastUpdatedBy":"Chris Tsang","lastUpdatedAt":1749059591000,"sidebarPosition":4,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Many to Many","permalink":"/SeaORM/docs/0.11.x/relation/many-to-many"},"next":{"title":"Self Referencing","permalink":"/SeaORM/docs/0.11.x/relation/self-referencing"}}');var t=i(88790),l=i(77162);const r={},o="Chained Relations",s={},d=[{value:"Lazy Loading",id:"lazy-loading",level:3},{value:"Eager Loading",id:"eager-loading",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"chained-relations",children:"Chained Relations"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"Related"})," trait is a representation of the arrows (1-1, 1-N, M-N) we draw on Entity Relationship Diagrams. A ",(0,t.jsx)(n.a,{href:"https://docs.rs/sea-orm/*/sea_orm/entity/trait.Linked.html",children:(0,t.jsx)(n.code,{children:"Linked"})})," is composed of a chain of relations, and is useful when:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"there exist multiple join paths between a pair of entities"}),"\n",(0,t.jsx)(n.li,{children:"joining across multiple entities in a relational query"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Take ",(0,t.jsx)(n.a,{href:"https://github.com/SeaQL/sea-orm/blob/master/src/tests_cfg/cake.rs",children:"this"})," as a simple example, where we join cake and filling via an intermediate ",(0,t.jsx)(n.code,{children:"cake_filling"})," table."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"#[derive(Debug)]\npub struct CakeToFilling;\n\nimpl Linked for CakeToFilling {\n    type FromEntity = cake::Entity;\n\n    type ToEntity = filling::Entity;\n\n    fn link(&self) -> Vec<RelationDef> {\n        vec![\n            cake_filling::Relation::Cake.def().rev(),\n            cake_filling::Relation::Filling.def(),\n        ]\n    }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Alternatively, the ",(0,t.jsx)(n.code,{children:"RelationDef"})," can be defined on the fly, where the following is equivalent to the above:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"#[derive(Debug)]\npub struct CakeToFilling;\n\nimpl Linked for CakeToFilling {\n    type FromEntity = cake::Entity;\n\n    type ToEntity = filling::Entity;\n\n    fn link(&self) -> Vec<RelationDef> {\n        vec![\n            cake_filling::Relation::Cake.def().rev(),\n            cake_filling::Entity::belongs_to(filling::Entity)\n                .from(cake_filling::Column::FillingId)\n                .to(filling::Column::Id)\n                .into(),\n        ]\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"lazy-loading",children:"Lazy Loading"}),"\n",(0,t.jsxs)(n.p,{children:["Find fillings that can be filled into a cake with the ",(0,t.jsx)(n.a,{href:"https://docs.rs/sea-orm/*/sea_orm/entity/prelude/trait.ModelTrait.html#method.find_linked",children:(0,t.jsx)(n.code,{children:"find_linked"})})," method."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'let cake_model = cake::Model {\n    id: 12,\n    name: "".to_owned(),\n};\n\nassert_eq!(\n    cake_model\n        .find_linked(cake::CakeToFilling)\n        .build(DbBackend::MySql)\n        .to_string(),\n    [\n        "SELECT `filling`.`id`, `filling`.`name`, `filling`.`vendor_id`",\n        "FROM `filling`",\n        "INNER JOIN `cake_filling` AS `r0` ON `r0`.`filling_id` = `filling`.`id`",\n        "INNER JOIN `cake` AS `r1` ON `r1`.`id` = `r0`.`cake_id`",\n        "WHERE `r1`.`id` = 12",\n    ]\n    .join(" ")\n);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"eager-loading",children:"Eager Loading"}),"\n",(0,t.jsxs)(n.p,{children:["Find all pairs of cake and filling together in a single select with the ",(0,t.jsx)(n.a,{href:"https://docs.rs/sea-orm/*/sea_orm/entity/prelude/struct.Select.html#method.find_also_linked",children:(0,t.jsx)(n.code,{children:"find_also_linked"})})," method."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'assert_eq!(\n    cake::Entity::find()\n        .find_also_linked(cake::CakeToFilling)\n        .build(DbBackend::MySql)\n        .to_string(),\n    [\n        "SELECT `cake`.`id` AS `A_id`, `cake`.`name` AS `A_name`,",\n        "`r1`.`id` AS `B_id`, `r1`.`name` AS `B_name`, `r1`.`vendor_id` AS `B_vendor_id`",\n        "FROM `cake`",\n        "LEFT JOIN `cake_filling` AS `r0` ON `cake`.`id` = `r0`.`cake_id`",\n        "LEFT JOIN `filling` AS `r1` ON `r0`.`filling_id` = `r1`.`id`",\n    ]\n    .join(" ")\n);\n'})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},77162:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var a=i(22374);const t={},l=a.createContext(t);function r(e){const n=a.useContext(l);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);