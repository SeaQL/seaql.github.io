"use strict";(self.webpackChunksea_orm=self.webpackChunksea_orm||[]).push([[91946],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var r=s(96540);const c={},a=r.createContext(c);function t(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),r.createElement(a.Provider,{value:n},e.children)}},61759:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"data-science/clickhouse","title":"ClickHouse","description":"sea-clickhouse is a ClickHouse client that integrates with the SeaQL ecosystem. It is a soft fork of clickhouse-rs, 100% compatible with all upstream features, and continually rebased on upstream.","source":"@site/docs/12-data-science/02-clickhouse.md","sourceDirName":"12-data-science","slug":"/data-science/clickhouse","permalink":"/SeaORM/docs/data-science/clickhouse","draft":false,"unlisted":false,"editUrl":"https://github.com/SeaQL/seaql.github.io/edit/master/SeaORM/docs/12-data-science/02-clickhouse.md","tags":[],"version":"current","lastUpdatedBy":"Chris Tsang","lastUpdatedAt":1772389428000,"sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Arrow & Parquet","permalink":"/SeaORM/docs/data-science/arrow-parquet"},"next":{"title":"Traits and Types","permalink":"/SeaORM/docs/internal-design/trait-and-type"}}');var c=s(74848),a=s(28453);const t={},l="ClickHouse",i={},o=[{value:"Setup",id:"setup",level:2},{value:"Dynamic DataRow",id:"dynamic-datarow",level:2},{value:"Inserting DataRows",id:"inserting-datarows",level:2},{value:"Column-Oriented Batches",id:"column-oriented-batches",level:2},{value:"Apache Arrow",id:"apache-arrow",level:2},{value:"SeaORM to ClickHouse",id:"seaorm-to-clickhouse",level:3},{value:"Arrow Schema to ClickHouse Table",id:"arrow-schema-to-clickhouse-table",level:3},{value:"Type Mapping",id:"type-mapping",level:2},{value:"Full Examples",id:"full-examples",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"clickhouse",children:"ClickHouse"})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.a,{href:"https://github.com/SeaQL/clickhouse-rs",children:(0,c.jsx)(n.code,{children:"sea-clickhouse"})})," is a ClickHouse client that integrates with the SeaQL ecosystem. It is a soft fork of ",(0,c.jsx)(n.a,{href:"https://github.com/ClickHouse/clickhouse-rs",children:(0,c.jsx)(n.code,{children:"clickhouse-rs"})}),", 100% compatible with all upstream features, and continually rebased on upstream."]}),"\n",(0,c.jsxs)(n.p,{children:["Query results are decoded into ",(0,c.jsx)(n.code,{children:"sea_query::Value"}),", giving you first-class support for ",(0,c.jsx)(n.code,{children:"DateTime"}),", ",(0,c.jsx)(n.code,{children:"Decimal"}),", ",(0,c.jsx)(n.code,{children:"BigDecimal"}),", ",(0,c.jsx)(n.code,{children:"Json"}),", arrays, and more without defining any schema structs. Apache Arrow is also supported: stream query results directly into ",(0,c.jsx)(n.code,{children:"RecordBatch"}),"es, or insert Arrow batches back into ClickHouse."]}),"\n",(0,c.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-toml",children:'[dependencies]\n# Dynamic DataRow + SeaQuery value support\nsea-clickhouse = { version = "0.14", features = ["sea-ql"] }\n\n# Apache Arrow support (includes sea-ql)\nsea-clickhouse = { version = "0.14", features = ["arrow"] }\n'})}),"\n",(0,c.jsx)(n.h2,{id:"dynamic-datarow",children:"Dynamic DataRow"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"fetch_rows()"})," decodes every column into the matching ",(0,c.jsx)(n.code,{children:"sea_query::Value"})," variant without needing a schema struct:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:"use clickhouse::{Client, DataRow, error::Result};\nuse sea_query::Value;\n\nlet mut cursor = client\n    .query(\n        \"SELECT\n            1::UInt8                              AS u8_col,\n            3.14::Float64                         AS f64_col,\n            'hello'::String                       AS str_col,\n            toDate('2026-01-15')                  AS date_col,\n            toDateTime('2026-01-15 12:34:56')     AS dt_col,\n            toDecimal64(123.45, 2)                AS dec64_col,\n            NULL::Nullable(Int32)                 AS null_col,\n            ['a', 'b', 'c']::Array(String)        AS arr_col\n        \",\n    )\n    .fetch_rows()?;\n\nlet row = cursor.next().await?.unwrap();\nassert_eq!(row.values[0], Value::TinyUnsigned(Some(1)));\nassert_eq!(row.values[2], Value::String(Some(\"hello\".into())));\nassert_eq!(row.values[7], Value::Json(Some(Box::new(serde_json::json!([\"a\", \"b\", \"c\"])))));\n"})}),"\n",(0,c.jsx)(n.p,{children:"Values can be converted to a desired type at runtime:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:'let row = cursor.next().await?.expect("expected one row");\n\nassert_eq!(row.try_get::<f64, _>(0)?, 2.0);          // by index\nassert_eq!(row.try_get::<Decimal, _>("value")?, 2.into()); // by column name\n'})}),"\n",(0,c.jsx)(n.h2,{id:"inserting-datarows",children:"Inserting DataRows"}),"\n",(0,c.jsxs)(n.p,{children:["Build ",(0,c.jsx)(n.code,{children:"DataRow"}),"s with a shared column list and insert them in a single streaming request:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:'use std::sync::Arc;\nuse clickhouse::{Client, DataRow};\nuse sea_query::Value;\n\nlet columns: Arc<[Arc<str>]> = Arc::from(["id".into(), "name".into(), "score".into()]);\n\nlet rows: Vec<DataRow> = (0u32..5)\n    .map(|i| DataRow {\n        columns: columns.clone(),\n        values: vec![\n            Value::Unsigned(Some(i)),\n            Value::String(Some("original".into())),\n            Value::Double(Some(i as f64 * 1.5)),\n        ],\n    })\n    .collect();\n\nlet mut insert = client.insert_data_row("my_table", &rows[0]).await?;\nfor row in &rows {\n    insert.write_row(row).await?;\n}\ninsert.end().await?;\n'})}),"\n",(0,c.jsx)(n.h2,{id:"column-oriented-batches",children:"Column-Oriented Batches"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"next_batch(max_rows)"})," accumulates rows column-by-column into a ",(0,c.jsx)(n.code,{children:"RowBatch"})," (one ",(0,c.jsx)(n.code,{children:"Vec<Value>"})," per column), making it a natural bridge toward Apache Arrow:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:'let mut cursor = client\n    .query("SELECT number::UInt64 AS n, number * 2 AS doubled FROM system.numbers LIMIT 1000")\n    .fetch_rows()?;\n\nwhile let Some(batch) = cursor.next_batch(256).await? {\n    // batch.column_names[i]  - column name\n    // batch.column_data[i]   - Vec<Value> for column i\n    // batch.num_rows\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"apache-arrow",children:"Apache Arrow"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"next_arrow_batch(chunk_size)"})," streams ClickHouse results as ",(0,c.jsx)(n.code,{children:"arrow::RecordBatch"}),"es, ready for DataFusion, Polars, Parquet export, or any Arrow consumer:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:'let mut cursor = client.query("SELECT * FROM sensor_data").fetch_rows()?;\n\nwhile let Some(batch) = cursor.next_arrow_batch(1000).await? {\n    arrow::util::pretty::print_batches(&[batch]).unwrap();\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"seaorm-to-clickhouse",children:"SeaORM to ClickHouse"}),"\n",(0,c.jsxs)(n.p,{children:["Build an Arrow ",(0,c.jsx)(n.code,{children:"RecordBatch"})," from SeaORM entities and insert it directly into ClickHouse:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:'use sea_orm::{ArrowSchema, Set};\n\n#[sea_orm::model]\n#[derive(Clone, Debug, PartialEq, DeriveEntityModel)]\n#[sea_orm(table_name = "measurement", arrow_schema)]\npub struct Model {\n    #[sea_orm(primary_key)]\n    pub id: i32,\n    pub recorded_at: ChronoDateTime,\n    pub sensor_id: i32,\n    pub temperature: f64,\n    #[sea_orm(column_type = "Decimal(Some((38, 4)))")]\n    pub voltage: Decimal,\n}\n\nlet models: Vec<measurement::ActiveModel> = vec![..];\nlet schema = measurement::Entity::arrow_schema();\nlet batch = measurement::ActiveModel::to_arrow(&models, &schema)?;\n\nlet mut insert = client.insert_arrow("measurement", &batch.schema()).await?;\ninsert.write_batch(&batch).await?;\ninsert.end().await?;\n'})}),"\n",(0,c.jsx)(n.h3,{id:"arrow-schema-to-clickhouse-table",children:"Arrow Schema to ClickHouse Table"}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"ClickHouseSchema::from_arrow"})," derives a full ",(0,c.jsx)(n.code,{children:"CREATE TABLE"})," DDL from an Arrow schema:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:'use clickhouse::schema::{ClickHouseSchema, Engine};\n\nlet mut schema = ClickHouseSchema::from_arrow(&batch.schema());\nschema\n    .table_name("measurement")\n    .engine(Engine::ReplacingMergeTree)\n    .primary_key(["recorded_at", "sensor_id"]);\nschema.find_column_mut("sensor_id").set_low_cardinality(true);\n\nlet ddl = schema.to_string();\nclient.query(&ddl).execute().await?;\n'})}),"\n",(0,c.jsx)(n.p,{children:"The generated DDL:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE measurement (\n    id Int32,\n    recorded_at DateTime64(6),\n    sensor_id Int32,\n    temperature Float64,\n    voltage Decimal(38, 4)\n) ENGINE = ReplacingMergeTree()\nPRIMARY KEY (recorded_at, sensor_id)\n"})}),"\n",(0,c.jsx)(n.h2,{id:"type-mapping",children:"Type Mapping"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"ClickHouse Type"}),(0,c.jsxs)(n.th,{children:[(0,c.jsx)(n.code,{children:"sea_query::Value"})," Variant"]})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Bool"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Value::Bool"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Int8"}),"\u2013",(0,c.jsx)(n.code,{children:"Int64"})]}),(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Value::TinyInt"}),"\u2013",(0,c.jsx)(n.code,{children:"Value::BigInt"})]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"UInt8"}),"\u2013",(0,c.jsx)(n.code,{children:"UInt64"})]}),(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Value::TinyUnsigned"}),"\u2013",(0,c.jsx)(n.code,{children:"Value::BigUnsigned"})]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Int128"})," / ",(0,c.jsx)(n.code,{children:"Int256"})," / ",(0,c.jsx)(n.code,{children:"UInt128"})," / ",(0,c.jsx)(n.code,{children:"UInt256"})]}),(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Value::BigDecimal"})," (scale 0)"]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Float32"})," / ",(0,c.jsx)(n.code,{children:"Float64"})]}),(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Value::Float"})," / ",(0,c.jsx)(n.code,{children:"Value::Double"})]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"String"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Value::String"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"FixedString(n)"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Value::Bytes"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"UUID"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Value::Uuid"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Date"})," / ",(0,c.jsx)(n.code,{children:"Date32"})]}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Value::ChronoDate"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"DateTime"})," / ",(0,c.jsx)(n.code,{children:"DateTime64"})]}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Value::ChronoDateTime"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Decimal32"})," / ",(0,c.jsx)(n.code,{children:"Decimal64"})]}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Value::Decimal"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Decimal128"})}),(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Value::Decimal"})," or ",(0,c.jsx)(n.code,{children:"Value::BigDecimal"})," if scale > 28"]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Decimal256"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Value::BigDecimal"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Array(T)"})," / ",(0,c.jsx)(n.code,{children:"Tuple(...)"})," / ",(0,c.jsx)(n.code,{children:"Map(K,V)"})]}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Value::Json"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsxs)(n.td,{children:[(0,c.jsx)(n.code,{children:"Nullable(T)"})," null"]}),(0,c.jsxs)(n.td,{children:["Typed ",(0,c.jsx)(n.code,{children:"None"})," variant"]})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"full-examples",children:"Full Examples"}),"\n",(0,c.jsxs)(n.p,{children:["Working examples are available in the ",(0,c.jsx)(n.a,{href:"https://github.com/SeaQL/clickhouse-rs",children:"sea-clickhouse repository"}),":"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://github.com/SeaQL/clickhouse-rs/blob/main/examples/data_rows.rs",children:(0,c.jsx)(n.code,{children:"data_rows"})})," \u2014 fetch rows and assert type mappings"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://github.com/SeaQL/clickhouse-rs/blob/main/examples/data_row_insert.rs",children:(0,c.jsx)(n.code,{children:"data_row_insert"})})," \u2014 insert, mutate, re-insert (ReplacingMergeTree)"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://github.com/SeaQL/clickhouse-rs/blob/main/examples/arrow_sensor_data.rs",children:(0,c.jsx)(n.code,{children:"arrow_sensor_data"})})," \u2014 sensor data processing via Arrow"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"https://github.com/SeaQL/clickhouse-rs/blob/main/sea-orm-arrow-example/src/main.rs",children:(0,c.jsx)(n.code,{children:"sea-orm-arrow-example"})})," \u2014 SeaORM entity to Arrow to ClickHouse"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}}}]);