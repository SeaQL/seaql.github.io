"use strict";(self.webpackChunksea_orm=self.webpackChunksea_orm||[]).push([[99142],{28453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>s});var t=n(96540);const d={},i=t.createContext(d);function a(e){const r=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:a(e.components),t.createElement(i.Provider,{value:r},e.children)}},46214:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"advanced-query/error-handling","title":"Error Handling","description":"All runtime errors in SeaORM are represented by DbErr.","source":"@site/docs/08-advanced-query/09-error-handling.md","sourceDirName":"08-advanced-query","slug":"/advanced-query/error-handling","permalink":"/SeaORM/docs/advanced-query/error-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/SeaQL/seaql.github.io/edit/master/SeaORM/docs/08-advanced-query/09-error-handling.md","tags":[],"version":"current","lastUpdatedBy":"Chris Tsang","lastUpdatedAt":1772368507000,"sidebarPosition":9,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Nested ActiveModel","permalink":"/SeaORM/docs/advanced-query/nested-active-model"},"next":{"title":"Advanced Joins","permalink":"/SeaORM/docs/advanced-query/advanced-joins"}}');var d=n(74848),i=n(28453);const a={},s="Error Handling",o={},c=[{value:"Handling Common SQL Errors",id:"handling-common-sql-errors",level:2},{value:"Error Variants Added in 2.0",id:"error-variants-added-in-20",level:2},{value:"Handling Database-Specific Errors",id:"handling-database-specific-errors",level:2}];function l(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.header,{children:(0,d.jsx)(r.h1,{id:"error-handling",children:"Error Handling"})}),"\n",(0,d.jsxs)(r.p,{children:["All runtime errors in SeaORM are represented by ",(0,d.jsx)(r.a,{href:"https://docs.rs/sea-orm/2.0.0-rc.25/sea_orm/error/enum.DbErr.html",children:(0,d.jsx)(r.code,{children:"DbErr"})}),"."]}),"\n",(0,d.jsx)(r.h2,{id:"handling-common-sql-errors",children:"Handling Common SQL Errors"}),"\n",(0,d.jsxs)(r.p,{children:["Use ",(0,d.jsx)(r.code,{children:"DbErr::sql_err()"})," to convert SQL-related errors into common database errors ",(0,d.jsx)(r.a,{href:"https://docs.rs/sea-orm/2.0.0-rc.25/sea_orm/error/enum.SqlErr.html",children:(0,d.jsx)(r.code,{children:"SqlErr"})}),", such as unique constraint or foreign key violation errors."]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-rust",children:'assert!(matches!(\n    cake.into_active_model().insert(db).await\n        .expect_err("Insert a row with duplicated primary key")\n        .sql_err(),\n    Some(SqlErr::UniqueConstraintViolation(_))\n));\n\nassert!(matches!(\n    fk_cake.insert(db).await\n        .expect_err("Insert a row with invalid foreign key")\n        .sql_err(),\n    Some(SqlErr::ForeignKeyConstraintViolation(_))\n));\n'})}),"\n",(0,d.jsx)(r.h2,{id:"error-variants-added-in-20",children:"Error Variants Added in 2.0"}),"\n",(0,d.jsx)(r.admonition,{type:"tip",children:(0,d.jsxs)(r.mdxAdmonitionTitle,{children:["Since ",(0,d.jsx)(r.code,{children:"2.0.0"})]})}),"\n",(0,d.jsx)(r.p,{children:"SeaORM 2.0 replaced several panics with proper error variants:"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"Error Variant"}),(0,d.jsx)(r.th,{children:"Replaces"}),(0,d.jsx)(r.th,{children:"When"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"DbErr::PrimaryKeyNotSet"})}),(0,d.jsxs)(r.td,{children:["panic in ",(0,d.jsx)(r.code,{children:"Update::one"})]}),(0,d.jsxs)(r.td,{children:["Primary key not set on ",(0,d.jsx)(r.code,{children:"UpdateOne"})," or ",(0,d.jsx)(r.code,{children:"DeleteOne"})]})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"DbErr::BackendNotSupported"})}),(0,d.jsx)(r.td,{children:"panic"}),(0,d.jsxs)(r.td,{children:["Calling ",(0,d.jsx)(r.code,{children:"exec_with_returning_keys"})," on MySQL"]})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"DbErr::AccessDenied"})}),(0,d.jsx)(r.td,{children:"N/A"}),(0,d.jsxs)(r.td,{children:["RBAC: operation blocked by ",(0,d.jsx)(r.code,{children:"RestrictedConnection"})]})]})]})]}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.code,{children:"Update::one"})," and ",(0,d.jsx)(r.code,{children:"Delete::one"})," now require calling ",(0,d.jsx)(r.code,{children:".validate()?"})," before ",(0,d.jsx)(r.code,{children:".build()"})," to catch ",(0,d.jsx)(r.code,{children:"PrimaryKeyNotSet"})," at the call site:"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-rust",children:'let stmt = Update::one(fruit::ActiveModel {\n    id: ActiveValue::NotSet,\n    name: ActiveValue::Set("Apple".to_owned()),\n    ..Default::default()\n})\n.validate(); // returns Err(DbErr::PrimaryKeyNotSet)\n'})}),"\n",(0,d.jsx)(r.h2,{id:"handling-database-specific-errors",children:"Handling Database-Specific Errors"}),"\n",(0,d.jsxs)(r.p,{children:["You can retrieve the database-specific error code from ",(0,d.jsx)(r.code,{children:"RuntimeErr"}),":"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-rust",children:'let my_cake = cake::ActiveModel { id: Set(1), .. };\n\nlet cake = my_cake.save(db).await.expect("could not insert cake");\n\n// Insert the same row again; fails because primary key must be unique.\nlet error: DbErr = cake\n    .into_active_model()\n    .insert(db)\n    .await\n    .expect_err("inserting should fail due to duplicate primary key");\n\nmatch error {\n    DbErr::Exec(RuntimeErr::SqlxError(error)) => match error {\n        sqlx::Error::Database(e) => {\n            // MySQL error code `23000` means `ER_DUP_KEY`\n            assert_eq!(e.code().unwrap(), "23000");\n        }\n        _ => panic!("Unexpected sqlx::Error kind"),\n    },\n    _ => panic!("Unexpected DbErr kind"),\n}\n'})})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(l,{...e})}):l(e)}}}]);