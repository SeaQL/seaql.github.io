"use strict";(self.webpackChunksea_orm=self.webpackChunksea_orm||[]).push([[42256],{28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>l});var i=n(96540);const a={},s=i.createContext(a);function r(e){const t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:t},e.children)}},97465:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"basic-crud/insert","title":"Insert","description":"Before diving into SeaORM insert we have to introduce ActiveValue and ActiveModel.","source":"@site/versioned_docs/version-0.7.x/06-basic-crud/02-insert.md","sourceDirName":"06-basic-crud","slug":"/basic-crud/insert","permalink":"/SeaORM/docs/0.7.x/basic-crud/insert","draft":false,"unlisted":false,"editUrl":"https://github.com/SeaQL/seaql.github.io/edit/master/SeaORM/versioned_docs/version-0.7.x/06-basic-crud/02-insert.md","tags":[],"version":"0.7.x","lastUpdatedBy":"Chris Tsang","lastUpdatedAt":1760007689000,"sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Select","permalink":"/SeaORM/docs/0.7.x/basic-crud/select"},"next":{"title":"Update","permalink":"/SeaORM/docs/0.7.x/basic-crud/update"}}');var a=n(74848),s=n(28453);const r={},l="Insert",d={},o=[{value:"ActiveValue",id:"activevalue",level:2},{value:"Model &amp; ActiveModel",id:"model--activemodel",level:2},{value:"Set ActiveModel from JSON Value",id:"set-activemodel-from-json-value",level:3},{value:"Insert One",id:"insert-one",level:2},{value:"Insert Many",id:"insert-many",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"insert",children:"Insert"})}),"\n",(0,a.jsxs)(t.p,{children:["Before diving into SeaORM insert we have to introduce ",(0,a.jsx)(t.code,{children:"ActiveValue"})," and ",(0,a.jsx)(t.code,{children:"ActiveModel"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"activevalue",children:"ActiveValue"}),"\n",(0,a.jsxs)(t.p,{children:["A wrapper struct to capture the changes made to ",(0,a.jsx)(t.code,{children:"ActiveModel"})," attributes."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",children:"use sea_orm::ActiveValue::NotSet;\n\n// Set value\nlet _: ActiveValue<i32> = Set(10);\n\n// NotSet value\nlet _: ActiveValue<i32> = NotSet;\n"})}),"\n",(0,a.jsx)(t.h2,{id:"model--activemodel",children:"Model & ActiveModel"}),"\n",(0,a.jsxs)(t.p,{children:["An ",(0,a.jsx)(t.code,{children:"ActiveModel"})," has all the attributes of ",(0,a.jsx)(t.code,{children:"Model"})," wrapped in ",(0,a.jsx)(t.code,{children:"ActiveValue"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["You can use ",(0,a.jsx)(t.code,{children:"ActiveModel"})," to insert a row with a subset of columns set."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",children:'let cheese: Option<cake::Model> = Cake::find_by_id(1).one(db).await?;\n\n// Get Model\nlet model: cake::Model = cheese.unwrap();\nassert_eq!(model.name, "Cheese Cake".to_owned());\n\n// Into ActiveModel\nlet active_model: cake::ActiveModel = model.into();\nassert_eq!(active_model.name, ActiveValue::unchanged("Cheese Cake".to_owned()));\n'})}),"\n",(0,a.jsx)(t.h3,{id:"set-activemodel-from-json-value",children:"Set ActiveModel from JSON Value"}),"\n",(0,a.jsxs)(t.p,{children:["If you want to save user input into the database you can easily convert JSON value into ",(0,a.jsx)(t.code,{children:"ActiveModel"}),". Note that you might want to ",(0,a.jsx)(t.a,{href:"https://serde.rs/attr-skip-serializing.html",children:"skip deserializing"})," JSON's primary key attribute, you can config that as shown below."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",children:'#[derive(Clone, Debug, PartialEq, DeriveEntityModel, Serialize, Deserialize)]\n#[sea_orm(table_name = "fruit")]\npub struct Model {\n    #[sea_orm(primary_key)]\n    #[serde(skip_deserializing)] // Skip deserializing\n    pub id: i32,\n    pub name: String,\n    pub cake_id: Option<i32>,\n}\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Set the attributes in ",(0,a.jsx)(t.code,{children:"ActiveModel"})," with ",(0,a.jsx)(t.code,{children:"set_from_json"})," method."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",children:'// A ActiveModel with primary key set\nlet mut fruit = fruit::ActiveModel {\n    id: ActiveValue::Set(1),\n    name: ActiveValue::NotSet,\n    cake_id: ActiveValue::NotSet,\n};\n\n// Note that this method will not alter the primary key values in ActiveModel\nfruit.set_from_json(json!({\n    "id": 8,\n    "name": "Apple",\n    "cake_id": 1,\n}))?;\n\nassert_eq!(\n    fruit,\n    fruit::ActiveModel {\n        id: ActiveValue::Set(1),\n        name: ActiveValue::Set("Apple".to_owned()),\n        cake_id: ActiveValue::Set(Some(1)),\n    }\n);\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Create a new ",(0,a.jsx)(t.code,{children:"ActiveModel"})," from JSON value with the ",(0,a.jsx)(t.code,{children:"from_json"})," method."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",children:'let fruit = fruit::ActiveModel::from_json(json!({\n    "name": "Apple",\n}))?;\n\nassert_eq!(\n    fruit,\n    fruit::ActiveModel {\n        id: ActiveValue::NotSet,\n        name: ActiveValue::Set("Apple".to_owned()),\n        cake_id: ActiveValue::NotSet,\n    }\n);\n'})}),"\n",(0,a.jsx)(t.h2,{id:"insert-one",children:"Insert One"}),"\n",(0,a.jsxs)(t.p,{children:["Insert an active model and get back a fresh ",(0,a.jsx)(t.code,{children:"Model"}),". Its value is retrieved from database, so any auto-generated fields will be populated."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",children:'let pear = fruit::ActiveModel {\n    name: Set("Pear".to_owned()),\n    ..Default::default() // all other attributes are `NotSet`\n};\n\nlet pear: fruit::Model = pear.insert(db).await?;\n'})}),"\n",(0,a.jsx)(t.p,{children:"Insert an active model and get back the last insert id. Its type matches the model's primary key type, so it could be a tuple if the model has a composite primary key."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",children:'let pear = fruit::ActiveModel {\n    name: Set("Pear".to_owned()),\n    ..Default::default() // all other attributes are `NotSet`\n};\n\nlet res: InsertResult = fruit::Entity::insert(pear).exec(db).await?;\nassert_eq!(res.last_insert_id, 28)\n'})}),"\n",(0,a.jsx)(t.h2,{id:"insert-many",children:"Insert Many"}),"\n",(0,a.jsx)(t.p,{children:"Insert many active models and get back the last insert id."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-rust",children:'let apple = fruit::ActiveModel {\n    name: Set("Apple".to_owned()),\n    ..Default::default()\n};\n\nlet orange = fruit::ActiveModel {\n    name: Set("Orange".to_owned()),\n    ..Default::default()\n};\n\nlet res: InsertResult = Fruit::insert_many(vec![apple, orange]).exec(db).await?;\nassert_eq!(res.last_insert_id, 30)\n'})})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);