"use strict";(self.webpackChunksea_orm=self.webpackChunksea_orm||[]).push([[56988],{13030:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>r});const o=JSON.parse('{"id":"install-and-config/connection","title":"Database Connection","description":"To obtain a database connection, use the Database interface:","source":"@site/versioned_docs/version-0.12.x/02-install-and-config/02-connection.md","sourceDirName":"02-install-and-config","slug":"/install-and-config/connection","permalink":"/SeaORM/docs/0.12.x/install-and-config/connection","draft":false,"unlisted":false,"editUrl":"https://github.com/SeaQL/seaql.github.io/edit/master/SeaORM/versioned_docs/version-0.12.x/02-install-and-config/02-connection.md","tags":[],"version":"0.12.x","lastUpdatedBy":"Chris Tsang","lastUpdatedAt":1761400599000,"sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Database & Async Runtime","permalink":"/SeaORM/docs/0.12.x/install-and-config/database-and-async-runtime"},"next":{"title":"Debug Log","permalink":"/SeaORM/docs/0.12.x/install-and-config/debug-log"}}');var t=s(74848),i=s(28453);const c={},a="Database Connection",l={},r=[{value:"Connection String",id:"connection-string",level:2},{value:"MySQL",id:"mysql",level:3},{value:"Postgres",id:"postgres",level:3},{value:"Specify a schema",id:"specify-a-schema",level:4},{value:"SQLite",id:"sqlite",level:3},{value:"In memory",id:"in-memory",level:4},{value:"Create file if not exists",id:"create-file-if-not-exists",level:4},{value:"Read only",id:"read-only",level:4},{value:"Connect Options",id:"connect-options",level:2},{value:"Checking Connection is Valid",id:"checking-connection-is-valid",level:2},{value:"Closing Connection",id:"closing-connection",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"database-connection",children:"Database Connection"})}),"\n",(0,t.jsxs)(n.p,{children:["To obtain a database connection, use the ",(0,t.jsx)(n.a,{href:"https://docs.rs/sea-orm/*/sea_orm/struct.Database.html",children:(0,t.jsx)(n.code,{children:"Database"})})," interface:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'let db: DatabaseConnection = Database::connect("protocol://username:password@host/database").await?;\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"protocol"})," can be ",(0,t.jsx)(n.code,{children:"mysql:"}),", ",(0,t.jsx)(n.code,{children:"postgres:"})," or ",(0,t.jsx)(n.code,{children:"sqlite:"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"host"})," is usually ",(0,t.jsx)(n.code,{children:"localhost"}),", a domain name or an IP address."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["If you can't get ",(0,t.jsx)(n.code,{children:"localhost"})," to work, try putting in an IP address and port number, e.g. ",(0,t.jsx)(n.code,{children:"127.0.0.1:3306"})," or even ",(0,t.jsx)(n.code,{children:"192.168.x.x"}),"."]})}),"\n",(0,t.jsxs)(n.p,{children:["Under the hood, a ",(0,t.jsx)(n.a,{href:"https://docs.rs/sqlx/0.5/sqlx/struct.Pool.html",children:(0,t.jsx)(n.code,{children:"sqlx::Pool"})})," is created and owned by ",(0,t.jsx)(n.a,{href:"https://docs.rs/sea-orm/*/sea_orm/enum.DatabaseConnection.html",children:(0,t.jsx)(n.code,{children:"DatabaseConnection"})}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Each time you call ",(0,t.jsx)(n.code,{children:"execute"})," or ",(0,t.jsx)(n.code,{children:"query_one/all"})," on it, a connection will be acquired and released from the pool."]}),"\n",(0,t.jsxs)(n.p,{children:["Multiple queries will execute in parallel as you ",(0,t.jsx)(n.code,{children:"await"})," on them."]}),"\n",(0,t.jsx)(n.h2,{id:"connection-string",children:"Connection String"}),"\n",(0,t.jsx)(n.p,{children:"Here are some tips for database specific options:"}),"\n",(0,t.jsx)(n.h3,{id:"mysql",children:"MySQL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mysql://username:password@host/database\n"})}),"\n",(0,t.jsx)(n.h3,{id:"postgres",children:"Postgres"}),"\n",(0,t.jsx)(n.h4,{id:"specify-a-schema",children:"Specify a schema"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"postgres://username:password@host/database?currentSchema=my_schema\n"})}),"\n",(0,t.jsx)(n.h3,{id:"sqlite",children:"SQLite"}),"\n",(0,t.jsx)(n.h4,{id:"in-memory",children:"In memory"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sqlite::memory:\n"})}),"\n",(0,t.jsx)(n.h4,{id:"create-file-if-not-exists",children:"Create file if not exists"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sqlite://path/to/db.sqlite?mode=rwc\n"})}),"\n",(0,t.jsx)(n.h4,{id:"read-only",children:"Read only"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sqlite://path/to/db.sqlite?mode=ro\n"})}),"\n",(0,t.jsx)(n.h2,{id:"connect-options",children:"Connect Options"}),"\n",(0,t.jsxs)(n.p,{children:["To configure the connection, use the ",(0,t.jsx)(n.a,{href:"https://docs.rs/sea-orm/*/sea_orm/struct.ConnectOptions.html",children:(0,t.jsx)(n.code,{children:"ConnectOptions"})})," interface:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'let mut opt = ConnectOptions::new("protocol://username:password@host/database");\nopt.max_connections(100)\n    .min_connections(5)\n    .connect_timeout(Duration::from_secs(8))\n    .acquire_timeout(Duration::from_secs(8))\n    .idle_timeout(Duration::from_secs(8))\n    .max_lifetime(Duration::from_secs(8))\n    .sqlx_logging(true)\n    .sqlx_logging_level(log::LevelFilter::Info)\n    .set_schema_search_path("my_schema"); // Setting default PostgreSQL schema\n\nlet db = Database::connect(opt).await?;\n'})}),"\n",(0,t.jsx)(n.h2,{id:"checking-connection-is-valid",children:"Checking Connection is Valid"}),"\n",(0,t.jsx)(n.p,{children:"Checks if a connection to the database is still valid."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"|db: DatabaseConnection| {\n    assert!(db.ping().await.is_ok());\n    db.clone().close().await;\n    assert!(matches!(db.ping().await, Err(DbErr::ConnectionAcquire)));\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"closing-connection",children:"Closing Connection"}),"\n",(0,t.jsxs)(n.p,{children:["The connection will be automatically closed on drop. To close the connection explicitly, call the ",(0,t.jsx)(n.code,{children:"close"})," method."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"let db = Database::connect(url).await?;\n\n// Closing connection here\ndb.close().await?;\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var o=s(96540);const t={},i=o.createContext(t);function c(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);