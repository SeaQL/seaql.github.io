"use strict";(self.webpackChunksea_orm=self.webpackChunksea_orm||[]).push([[98466],{28453:(e,r,n)=>{n.d(r,{R:()=>s,x:()=>c});var t=n(96540);const d={},i=t.createContext(d);function s(e){const r=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),t.createElement(i.Provider,{value:r},e.children)}},87991:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"advanced-query/error-handling","title":"\u9519\u8bef\u5904\u7406","description":"SeaORM \u4e2d\u7684\u6240\u6709\u8fd0\u884c\u65f6\u9519\u8bef\u7531 DbErr \u8868\u793a\u3002","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/08-advanced-query/09-error-handling.md","sourceDirName":"08-advanced-query","slug":"/advanced-query/error-handling","permalink":"/SeaORM/zh-CN/docs/advanced-query/error-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/SeaQL/seaql.github.io/edit/master/SeaORM/docs/08-advanced-query/09-error-handling.md","tags":[],"version":"current","lastUpdatedBy":"Chris Tsang","lastUpdatedAt":1772368507000,"sidebarPosition":9,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u5d4c\u5957 ActiveModel","permalink":"/SeaORM/zh-CN/docs/advanced-query/nested-active-model"},"next":{"title":"\u9ad8\u7ea7\u8fde\u63a5","permalink":"/SeaORM/zh-CN/docs/advanced-query/advanced-joins"}}');var d=n(74848),i=n(28453);const s={},c="\u9519\u8bef\u5904\u7406",a={},o=[{value:"\u5904\u7406\u5e38\u89c1 SQL \u9519\u8bef",id:"\u5904\u7406\u5e38\u89c1-sql-\u9519\u8bef",level:2},{value:"2.0 \u4e2d\u65b0\u589e\u7684\u9519\u8bef\u53d8\u4f53",id:"20-\u4e2d\u65b0\u589e\u7684\u9519\u8bef\u53d8\u4f53",level:2},{value:"\u5904\u7406\u6570\u636e\u5e93\u7279\u5b9a\u9519\u8bef",id:"\u5904\u7406\u6570\u636e\u5e93\u7279\u5b9a\u9519\u8bef",level:2}];function l(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.header,{children:(0,d.jsx)(r.h1,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"})}),"\n",(0,d.jsxs)(r.p,{children:["SeaORM \u4e2d\u7684\u6240\u6709\u8fd0\u884c\u65f6\u9519\u8bef\u7531 ",(0,d.jsx)(r.a,{href:"https://docs.rs/sea-orm/2.0.0-rc.25/sea_orm/error/enum.DbErr.html",children:(0,d.jsx)(r.code,{children:"DbErr"})})," \u8868\u793a\u3002"]}),"\n",(0,d.jsx)(r.h2,{id:"\u5904\u7406\u5e38\u89c1-sql-\u9519\u8bef",children:"\u5904\u7406\u5e38\u89c1 SQL \u9519\u8bef"}),"\n",(0,d.jsxs)(r.p,{children:["\u4f7f\u7528 ",(0,d.jsx)(r.code,{children:"DbErr::sql_err()"})," \u5c06 SQL \u76f8\u5173\u9519\u8bef\u8f6c\u6362\u4e3a\u5e38\u89c1\u6570\u636e\u5e93\u9519\u8bef ",(0,d.jsx)(r.a,{href:"https://docs.rs/sea-orm/2.0.0-rc.25/sea_orm/error/enum.SqlErr.html",children:(0,d.jsx)(r.code,{children:"SqlErr"})}),"\uff0c\u4f8b\u5982\u552f\u4e00\u7ea6\u675f\u6216\u5916\u952e\u8fdd\u53cd\u9519\u8bef\u3002"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-rust",children:'assert!(matches!(\n    cake.into_active_model().insert(db).await\n        .expect_err("Insert a row with duplicated primary key")\n        .sql_err(),\n    Some(SqlErr::UniqueConstraintViolation(_))\n));\n\nassert!(matches!(\n    fk_cake.insert(db).await\n        .expect_err("Insert a row with invalid foreign key")\n        .sql_err(),\n    Some(SqlErr::ForeignKeyConstraintViolation(_))\n));\n'})}),"\n",(0,d.jsx)(r.h2,{id:"20-\u4e2d\u65b0\u589e\u7684\u9519\u8bef\u53d8\u4f53",children:"2.0 \u4e2d\u65b0\u589e\u7684\u9519\u8bef\u53d8\u4f53"}),"\n",(0,d.jsx)(r.admonition,{type:"tip",children:(0,d.jsxs)(r.mdxAdmonitionTitle,{children:["\u81ea ",(0,d.jsx)(r.code,{children:"2.0.0"})," \u8d77"]})}),"\n",(0,d.jsx)(r.p,{children:"SeaORM 2.0 \u7528\u9002\u5f53\u7684\u9519\u8bef\u53d8\u4f53\u66ff\u6362\u4e86\u591a\u4e2a panic\uff1a"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"\u9519\u8bef\u53d8\u4f53"}),(0,d.jsx)(r.th,{children:"\u66ff\u6362"}),(0,d.jsx)(r.th,{children:"\u4f55\u65f6"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"DbErr::PrimaryKeyNotSet"})}),(0,d.jsxs)(r.td,{children:[(0,d.jsx)(r.code,{children:"Update::one"})," \u4e2d\u7684 panic"]}),(0,d.jsxs)(r.td,{children:[(0,d.jsx)(r.code,{children:"UpdateOne"})," \u6216 ",(0,d.jsx)(r.code,{children:"DeleteOne"})," \u4e0a\u4e3b\u952e\u672a\u8bbe\u7f6e"]})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"DbErr::BackendNotSupported"})}),(0,d.jsx)(r.td,{children:"panic"}),(0,d.jsxs)(r.td,{children:["\u5728 MySQL \u4e0a\u8c03\u7528 ",(0,d.jsx)(r.code,{children:"exec_with_returning_keys"})]})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"DbErr::AccessDenied"})}),(0,d.jsx)(r.td,{children:"N/A"}),(0,d.jsxs)(r.td,{children:["RBAC\uff1a\u64cd\u4f5c\u88ab ",(0,d.jsx)(r.code,{children:"RestrictedConnection"})," \u963b\u6b62"]})]})]})]}),"\n",(0,d.jsxs)(r.p,{children:[(0,d.jsx)(r.code,{children:"Update::one"})," \u548c ",(0,d.jsx)(r.code,{children:"Delete::one"})," \u73b0\u5728\u9700\u8981\u5728 ",(0,d.jsx)(r.code,{children:".build()"})," \u4e4b\u524d\u8c03\u7528 ",(0,d.jsx)(r.code,{children:".validate()?"}),"\uff0c\u4ee5\u5728\u8c03\u7528\u5904\u6355\u83b7 ",(0,d.jsx)(r.code,{children:"PrimaryKeyNotSet"}),"\uff1a"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-rust",children:'let stmt = Update::one(fruit::ActiveModel {\n    id: ActiveValue::NotSet,\n    name: ActiveValue::Set("Apple".to_owned()),\n    ..Default::default()\n})\n.validate(); // returns Err(DbErr::PrimaryKeyNotSet)\n'})}),"\n",(0,d.jsx)(r.h2,{id:"\u5904\u7406\u6570\u636e\u5e93\u7279\u5b9a\u9519\u8bef",children:"\u5904\u7406\u6570\u636e\u5e93\u7279\u5b9a\u9519\u8bef"}),"\n",(0,d.jsxs)(r.p,{children:["\u4f60\u53ef\u4ee5\u4ece ",(0,d.jsx)(r.code,{children:"RuntimeErr"})," \u4e2d\u83b7\u53d6\u6570\u636e\u5e93\u7279\u5b9a\u7684\u9519\u8bef\u4ee3\u7801\uff1a"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-rust",children:'let my_cake = cake::ActiveModel { id: Set(1), .. };\n\nlet cake = my_cake.save(db).await.expect("could not insert cake");\n\n// Insert the same row again; fails because primary key must be unique.\nlet error: DbErr = cake\n    .into_active_model()\n    .insert(db)\n    .await\n    .expect_err("inserting should fail due to duplicate primary key");\n\nmatch error {\n    DbErr::Exec(RuntimeErr::SqlxError(error)) => match error {\n        sqlx::Error::Database(e) => {\n            // MySQL error code `23000` means `ER_DUP_KEY`\n            assert_eq!(e.code().unwrap(), "23000");\n        }\n        _ => panic!("Unexpected sqlx::Error kind"),\n    },\n    _ => panic!("Unexpected DbErr kind"),\n}\n'})})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(l,{...e})}):l(e)}}}]);