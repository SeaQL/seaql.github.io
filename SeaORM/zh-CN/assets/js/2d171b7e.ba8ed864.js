"use strict";(self.webpackChunksea_orm=self.webpackChunksea_orm||[]).push([[60244],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var a=t(96540);const o={},c=a.createContext(o);function s(e){const n=a.useContext(c);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(c.Provider,{value:n},e.children)}},43697:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"advanced-query/aggregate-function","title":"\u805a\u5408\u51fd\u6570","description":"\u4f60\u53ef\u4ee5\u4f7f\u7528 group_by \u65b9\u6cd5\u5bf9\u7ed3\u679c\u8fdb\u884c\u5206\u7ec4\u3002\u5982\u679c\u5e0c\u671b\u8fdb\u4e00\u6b65\u9650\u5236\u5206\u7ec4\u7ed3\u679c\u96c6\uff0c\u53ef\u4ee5\u5e94\u7528 having \u65b9\u6cd5\u3002","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/08-advanced-query/03-aggregate-function.md","sourceDirName":"08-advanced-query","slug":"/advanced-query/aggregate-function","permalink":"/SeaORM/zh-CN/docs/advanced-query/aggregate-function","draft":false,"unlisted":false,"editUrl":"https://github.com/SeaQL/seaql.github.io/edit/master/SeaORM/docs/08-advanced-query/03-aggregate-function.md","tags":[],"version":"current","lastUpdatedBy":"Chris Tsang","lastUpdatedAt":1772368507000,"sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u6761\u4ef6\u8868\u8fbe\u5f0f","permalink":"/SeaORM/zh-CN/docs/advanced-query/conditional-expression"},"next":{"title":"\u81ea\u5b9a\u4e49\u8fde\u63a5\u6761\u4ef6","permalink":"/SeaORM/zh-CN/docs/advanced-query/custom-join-condition"}}');var o=t(74848),c=t(28453);const s={},r="\u805a\u5408\u51fd\u6570",i={},l=[{value:"\u6c42\u548c",id:"\u6c42\u548c",level:2},{value:"\u5bf9\u5355\u5217\u6c42\u548c",id:"\u5bf9\u5355\u5217\u6c42\u548c",level:3},{value:"\u5e26\u5206\u7ec4\u7684\u6c42\u548c",id:"\u5e26\u5206\u7ec4\u7684\u6c42\u548c",level:3},{value:"\u5206\u7ec4",id:"\u5206\u7ec4",level:2},{value:"\u5c06\u5206\u7ec4\u4e0e\u805a\u5408\u51fd\u6570\u7ed3\u5408\u4f7f\u7528",id:"\u5c06\u5206\u7ec4\u4e0e\u805a\u5408\u51fd\u6570\u7ed3\u5408\u4f7f\u7528",level:3},{value:"Having \u6761\u4ef6",id:"having-\u6761\u4ef6",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"\u805a\u5408\u51fd\u6570",children:"\u805a\u5408\u51fd\u6570"})}),"\n",(0,o.jsxs)(n.p,{children:["\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,o.jsx)(n.code,{children:"group_by"})," \u65b9\u6cd5\u5bf9\u7ed3\u679c\u8fdb\u884c\u5206\u7ec4\u3002\u5982\u679c\u5e0c\u671b\u8fdb\u4e00\u6b65\u9650\u5236\u5206\u7ec4\u7ed3\u679c\u96c6\uff0c\u53ef\u4ee5\u5e94\u7528 ",(0,o.jsx)(n.code,{children:"having"})," \u65b9\u6cd5\u3002"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["\u5305\u62ec ",(0,o.jsx)(n.code,{children:"max"}),"\u3001",(0,o.jsx)(n.code,{children:"min"}),"\u3001",(0,o.jsx)(n.code,{children:"sum"}),"\u3001",(0,o.jsx)(n.code,{children:"avg"}),"\u3001",(0,o.jsx)(n.code,{children:"count"})," \u5728\u5185\u7684\u805a\u5408\u51fd\u6570\u53ef\u5728 ",(0,o.jsx)(n.a,{href:"https://docs.rs/sea-orm/2.0.0-rc.25/sea_orm/entity/trait.ColumnTrait.html",children:(0,o.jsx)(n.code,{children:"ColumnTrait"})})," \u4e2d\u4f7f\u7528\u3002"]})}),"\n",(0,o.jsx)(n.h2,{id:"\u6c42\u548c",children:"\u6c42\u548c"}),"\n",(0,o.jsx)(n.h3,{id:"\u5bf9\u5355\u5217\u6c42\u548c",children:"\u5bf9\u5355\u5217\u6c42\u548c"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'let sum_order_total: Decimal = order::Entity::find()\n    .select_only()\n    .column_as(order::Column::Total.sum(), "sum")\n    .into_tuple()\n    .one(db)\n    .await?\n    .unwrap();\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\u5e26\u5206\u7ec4\u7684\u6c42\u548c",children:"\u5e26\u5206\u7ec4\u7684\u6c42\u548c"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'let (customer, total_spent): (String, Decimal) = customer::Entity::find()\n    .left_join(order::Entity)\n    .select_only()\n    .column(customer::Column::Name)\n    .column_as(order::Column::Total.sum(), "sum")\n    .group_by(customer::Column::Name)\n    .into_tuple()\n    .one(db)\n    .await?\n    .unwrap();\n\nassert_eq!(customer, "Kate");\nassert_eq!(total_spent, 25.into());\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u5206\u7ec4",children:"\u5206\u7ec4"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"group_by"})," \u65b9\u6cd5\u53ef\u4ee5\u63a5\u53d7 Entity \u7684\u5217\u6216\u590d\u6742\u7684 ",(0,o.jsx)(n.a,{href:"https://docs.rs/sea-query/*/sea_query/expr/enum.SimpleExpr.html",children:(0,o.jsx)(n.code,{children:"sea_query::SimpleExpr"})}),"\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'assert_eq!(\n    cake::Entity::find()\n        .select_only()\n        .column(cake::Column::Name)\n        .group_by(cake::Column::Name)\n        .build(DbBackend::Postgres)\n        .to_string(),\n    r#"SELECT "cake"."name" FROM "cake" GROUP BY "cake"."name""#\n);\n\nassert_eq!(\n    cake::Entity::find()\n        .select_only()\n        .column_as(cake::Column::Id.count(), "count")\n        .column_as(cake::Column::Id.sum(), "sum_of_id")\n        .group_by(cake::Column::Name)\n        .build(DbBackend::Postgres)\n        .to_string(),\n    r#"SELECT COUNT("cake"."id") AS "count", SUM("cake"."id") AS "sum_of_id" FROM "cake" GROUP BY "cake"."name""#\n);\n'})}),"\n",(0,o.jsx)(n.h3,{id:"\u5c06\u5206\u7ec4\u4e0e\u805a\u5408\u51fd\u6570\u7ed3\u5408\u4f7f\u7528",children:"\u5c06\u5206\u7ec4\u4e0e\u805a\u5408\u51fd\u6570\u7ed3\u5408\u4f7f\u7528"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'#[derive(Debug, FromQueryResult)]\nstruct SelectResult {\n    name: String,\n    num_orders: i64,\n    total_spent: Decimal,\n    min_spent: Decimal,\n    max_spent: Decimal,\n}\n\nlet select = customer::Entity::find()\n    .left_join(order::Entity)\n    .select_only()\n    .column(customer::Column::Name)\n    .column_as(order::Column::Total.count(), "num_orders")\n    .column_as(order::Column::Total.sum(), "total_spent")\n    .column_as(order::Column::Total.min(), "min_spent")\n    .column_as(order::Column::Total.max(), "max_spent")\n    .order_by_asc(customer::Column::Name)\n    .group_by(customer::Column::Name);\n\nlet result: Option<SelectResult> = select\n    .into_model()\n    .one(&ctx.db)\n    .await?;\n'})}),"\n",(0,o.jsx)(n.h2,{id:"having-\u6761\u4ef6",children:"Having \u6761\u4ef6"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"having"})," \u65b9\u6cd5\u53ef\u4ee5\u63a5\u53d7\u524d\u4e00\u8282\u4ecb\u7ecd\u7684\u4efb\u4f55\u6761\u4ef6\u8868\u8fbe\u5f0f\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'assert_eq!(\n    cake::Entity::find()\n        .having(cake::Column::Id.eq(4))\n        .having(cake::Column::Id.eq(5))\n        .build(DbBackend::MySql)\n        .to_string(),\n    "SELECT `cake`.`id`, `cake`.`name` FROM `cake` HAVING `cake`.`id` = 4 AND `cake`.`id` = 5"\n);\n\nassert_eq!(\n    cake::Entity::find()\n        .select_only()\n        .column_as(cake::Column::Id.count(), "count")\n        .column_as(cake::Column::Id.sum(), "sum_of_id")\n        .group_by(cake::Column::Name)\n        .having(Expr::col("count").gt(6))\n        .build(DbBackend::MySql)\n        .to_string(),\n    "SELECT COUNT(`cake`.`id`) AS `count`, SUM(`cake`.`id`) AS `sum_of_id` FROM `cake` GROUP BY `cake`.`name` HAVING `count` > 6"\n);\n'})})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);