"use strict";(self.webpackChunksea_orm=self.webpackChunksea_orm||[]).push([[95550],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var i=t(96540);const d={},c=i.createContext(d);function o(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:o(e.components),i.createElement(c.Provider,{value:n},e.children)}},83709:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>s});const i=JSON.parse('{"id":"basic-crud/custom-active-model","title":"\u81ea\u5b9a\u4e49 ActiveModel","description":"\u521b\u5efa\u5305\u542b\u6a21\u578b\u90e8\u5206\u5b57\u6bb5\u7684\u81ea\u5b9a\u4e49\u7ed3\u6784\u4f53\uff0c\u5b9e\u73b0 IntoActiveModel\uff0c\u53ef\u901a\u8fc7 intoactivemodel \u65b9\u6cd5\u8f6c\u6362\u4e3a ActiveModel\u3002\u4f8b\u5982\uff0c\u53ef\u7528\u4f5c REST API \u4e2d\u7684\u8868\u5355\u63d0\u4ea4\u3002","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/05-basic-crud/10-custom-active-model.md","sourceDirName":"05-basic-crud","slug":"/basic-crud/custom-active-model","permalink":"/SeaORM/zh-CN/docs/basic-crud/custom-active-model","draft":false,"unlisted":false,"editUrl":"https://github.com/SeaQL/seaql.github.io/edit/master/SeaORM/docs/05-basic-crud/10-custom-active-model.md","tags":[],"version":"current","lastUpdatedBy":"Chris Tsang","lastUpdatedAt":1772368507000,"sidebarPosition":10,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u539f\u59cb SQL","permalink":"/SeaORM/zh-CN/docs/basic-crud/raw-sql"},"next":{"title":"\u4e00\u5bf9\u4e00","permalink":"/SeaORM/zh-CN/docs/relation/one-to-one"}}');var d=t(74848),c=t(28453);const o={},r="\u81ea\u5b9a\u4e49 ActiveModel",l={},s=[{value:"\u9ad8\u7ea7\u5c5e\u6027",id:"\u9ad8\u7ea7\u5c5e\u6027",level:2},{value:"\u8ba1\u7b97\u9ed8\u8ba4\u503c\u4e0e\u81ea\u52a8\u8bbe\u7f6e\u5b57\u6bb5",id:"\u8ba1\u7b97\u9ed8\u8ba4\u503c\u4e0e\u81ea\u52a8\u8bbe\u7f6e\u5b57\u6bb5",level:3},{value:"\u5ffd\u7565\u5b57\u6bb5",id:"\u5ffd\u7565\u5b57\u6bb5",level:3},{value:"\u7a77\u4e3e\u6a21\u5f0f",id:"\u7a77\u4e3e\u6a21\u5f0f",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:3},{value:"PartialModel \u8f6c ActiveModel",id:"partialmodel-\u8f6c-activemodel",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"\u81ea\u5b9a\u4e49-activemodel",children:"\u81ea\u5b9a\u4e49 ActiveModel"})}),"\n",(0,d.jsxs)(n.p,{children:["\u521b\u5efa\u5305\u542b\u6a21\u578b\u90e8\u5206\u5b57\u6bb5\u7684\u81ea\u5b9a\u4e49\u7ed3\u6784\u4f53\uff0c\u5b9e\u73b0 ",(0,d.jsx)(n.code,{children:"IntoActiveModel"}),"\uff0c\u53ef\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"into_active_model"})," \u65b9\u6cd5\u8f6c\u6362\u4e3a ",(0,d.jsx)(n.code,{children:"ActiveModel"}),"\u3002\u4f8b\u5982\uff0c\u53ef\u7528\u4f5c REST API \u4e2d\u7684\u8868\u5355\u63d0\u4ea4\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"IntoActiveValue"})," \u7279\u5f81\u5141\u8bb8\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"into_active_value"})," \u65b9\u6cd5\u5c06 ",(0,d.jsx)(n.code,{children:"Option<T>"})," \u8f6c\u6362\u4e3a ",(0,d.jsx)(n.code,{children:"ActiveValue<T>"}),"\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-rust",children:'// Define regular model as usual\n#[derive(Clone, Debug, PartialEq, Eq, DeriveEntityModel)]\n#[sea_orm(table_name = "fruit")]\npub struct Model {\n    #[sea_orm(primary_key)]\n    pub id: i32,\n    pub name: String,\n    pub cake_id: Option<i32>,\n}\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u521b\u5efa\u7701\u7565\u90e8\u5206\u5b57\u6bb5\u7684\u65b0\u7ed3\u6784\u4f53\u3002"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-rust",children:'use sea_orm::ActiveValue::NotSet;\n\n#[derive(DeriveIntoActiveModel)]\npub struct NewFruit {\n    // id is omitted\n    pub name: String,\n    // it is required as opposed to optional in Model\n    pub cake_id: i32,\n}\n\nassert_eq!(\n    NewFruit {\n        name: "Apple".to_owned(),\n        cake_id: 1,\n    }\n    .into_active_model(),\n    fruit::ActiveModel {\n        id: NotSet,\n        name: Set("Apple".to_owned()),\n        cake_id: Set(Some(1)),\n    }\n);\n'})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Option<Option<T>>"})," \u5141\u8bb8 ",(0,d.jsx)(n.code,{children:"Some(None)"})," \u5c06\u5217\u66f4\u65b0\u4e3a NULL\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-rust",children:"use sea_orm::ActiveValue::NotSet;\n\n#[derive(DeriveIntoActiveModel)]\npub struct UpdateFruit {\n    pub cake_id: Option<Option<i32>>,\n}\n\nassert_eq!(\n    UpdateFruit { cake_id: Some(Some(1)) }.into_active_model(),\n    fruit::ActiveModel { id: NotSet, name: NotSet, cake_id: Set(Some(1)) }\n);\n\nassert_eq!(\n    UpdateFruit { cake_id: Some(None) }.into_active_model(),\n    fruit::ActiveModel { id: NotSet, name: NotSet, cake_id: Set(None) }\n);\n\nassert_eq!(\n    UpdateFruit { cake_id: None }.into_active_model(),\n    fruit::ActiveModel { id: NotSet, name: NotSet, cake_id: NotSet }\n);\n"})}),"\n",(0,d.jsx)(n.h2,{id:"\u9ad8\u7ea7\u5c5e\u6027",children:"\u9ad8\u7ea7\u5c5e\u6027"}),"\n",(0,d.jsx)(n.admonition,{type:"tip",children:(0,d.jsxs)(n.mdxAdmonitionTitle,{children:["Since ",(0,d.jsx)(n.code,{children:"2.0.0"})]})}),"\n",(0,d.jsx)(n.h3,{id:"\u8ba1\u7b97\u9ed8\u8ba4\u503c\u4e0e\u81ea\u52a8\u8bbe\u7f6e\u5b57\u6bb5",children:"\u8ba1\u7b97\u9ed8\u8ba4\u503c\u4e0e\u81ea\u52a8\u8bbe\u7f6e\u5b57\u6bb5"}),"\n",(0,d.jsxs)(n.p,{children:["\u5728\u5bb9\u5668\u7ea7\u522b\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:'set(field = "expr")'})," \u6ce8\u5165\u4e0d\u5c5e\u4e8e\u7ed3\u6784\u4f53\u7684\u5b57\u6bb5\uff0c\u5728 ",(0,d.jsx)(n.code,{children:"Option<T>"})," \u5b57\u6bb5\u4e0a\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:'#[sea_orm(default = "expr")]'})," \u5728 ",(0,d.jsx)(n.code,{children:"None"})," \u65f6\u63d0\u4f9b\u56de\u9000\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-rust",children:'const SYSTEM_USER_ID: i32 = 0;\n\n#[derive(DeriveIntoActiveModel)]\n#[sea_orm(\n    active_model = "post::ActiveModel",\n    set(updated_at = "chrono::Utc::now()"),\n    set(version = "1")\n)]\nstruct CreatePost {\n    title: String,\n    content: String,\n    #[sea_orm(default = "chrono::Utc::now()")]\n    published_at: Option<chrono::DateTime<chrono::Utc>>,\n    #[sea_orm(default = "SYSTEM_USER_ID")]\n    author_id: Option<i32>,\n}\n'})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:'set(field = "expr")'})," \u63a5\u53d7\u4efb\u610f Rust \u8868\u8fbe\u5f0f\uff1a\u51fd\u6570\u3001\u5e38\u91cf\u3001\u5b57\u9762\u91cf\u3002\u591a\u4e2a ",(0,d.jsx)(n.code,{children:"set"})," \u5c5e\u6027\u4f1a\u5408\u5e76\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:'#[sea_orm(default = "expr")]'})," \u4e3a ",(0,d.jsx)(n.code,{children:"Option<T>"})," \u5b57\u6bb5\u63d0\u4f9b\u56de\u9000\uff1a",(0,d.jsx)(n.code,{children:"Some(v)"})," \u53d8\u4e3a ",(0,d.jsx)(n.code,{children:"Set(v)"}),"\uff0c",(0,d.jsx)(n.code,{children:"None"})," \u53d8\u4e3a ",(0,d.jsx)(n.code,{children:"Set(expr)"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"#[sea_orm(default)]"}),"\uff08\u88f8\uff09\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"Default::default()"})," \u4f5c\u4e3a\u56de\u9000\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:'active_model = "..."'})," \u663e\u5f0f\u6307\u5b9a\u76ee\u6807 ActiveModel \u7c7b\u578b\u3002"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u5ffd\u7565\u5b57\u6bb5",children:"\u5ffd\u7565\u5b57\u6bb5"}),"\n",(0,d.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"#[sea_orm(ignore)]"})," \u6392\u9664\u6ca1\u6709\u5bf9\u5e94\u5217\u7684\u4ec5 DTO \u5b57\u6bb5\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-rust",children:'#[derive(DeriveIntoActiveModel)]\n#[sea_orm(active_model = "account::ActiveModel")]\nstruct UpdateAccount {\n    id: i32,\n    name: String,\n    #[sea_orm(ignore)]\n    audit_log: String,\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"\u7a77\u4e3e\u6a21\u5f0f",children:"\u7a77\u4e3e\u6a21\u5f0f"}),"\n",(0,d.jsxs)(n.p,{children:["\u6dfb\u52a0 ",(0,d.jsx)(n.code,{children:"exhaustive"})," \u4ee5\u79fb\u9664 ",(0,d.jsx)(n.code,{children:"..Default::default()"})," \u5c55\u5f00\uff0c\u5f3a\u5236\u6bcf\u4e2a ActiveModel \u5b57\u6bb5\u90fd\u7531\u7ed3\u6784\u4f53\u3001",(0,d.jsx)(n.code,{children:"set"})," \u6216 ",(0,d.jsx)(n.code,{children:"default"})," \u663e\u5f0f\u8986\u76d6\uff1a"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-rust",children:'#[derive(DeriveIntoActiveModel)]\n#[sea_orm(\n    active_model = "account::ActiveModel",\n    exhaustive,\n    set(updated_at = "chrono::Utc::now()")\n)]\nstruct UpdateAccount {\n    id: i32,\n    #[sea_orm(default = "false")]\n    disabled: Option<bool>,\n    #[sea_orm(ignore)]\n    audit_log: String,\n}\n'})}),"\n",(0,d.jsxs)(n.p,{children:["\u8fd9\u53ef\u4ee5\u5728\u7f16\u8bd1\u65f6\u4fdd\u8bc1\u6ca1\u6709\u5b57\u6bb5\u610f\u5916\u4fdd\u6301\u4e3a ",(0,d.jsx)(n.code,{children:"NotSet"}),"\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u573a\u666f"}),(0,d.jsx)(n.th,{children:"\u5c5e\u6027"}),(0,d.jsx)(n.th,{children:"ActiveModel \u4e2d\u7684\u7ed3\u679c"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u76f4\u63a5\u63d0\u4f9b\u5b57\u6bb5"}),(0,d.jsx)(n.td,{children:"\u6b63\u5e38\u58f0\u660e\u5b57\u6bb5"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Set(value)"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5b57\u6bb5\u4e0d\u5728\u7ed3\u6784\u4f53\u4e2d\u4f46\u5fc5\u987b\u8bbe\u7f6e"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:'set(field = "expr")'})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Set(expr)"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u53ef\u9009\u5b57\u6bb5\u5e76\u63d0\u4f9b\u56de\u9000\u503c"}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"Option<T>"})," + ",(0,d.jsx)(n.code,{children:'#[sea_orm(default = "expr")]'})]}),(0,d.jsxs)(n.td,{children:[(0,d.jsx)(n.code,{children:"Some(v)"})," \u2192 ",(0,d.jsx)(n.code,{children:"Set(v)"}),", ",(0,d.jsx)(n.code,{children:"None"})," \u2192 ",(0,d.jsx)(n.code,{children:"Set(expr)"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4ec5 DTO \u5b57\u6bb5\uff0c\u65e0\u5bf9\u5e94\u5217"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"#[sea_orm(ignore)]"})}),(0,d.jsx)(n.td,{children:"\u6392\u9664"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5b57\u6bb5\u672a\u58f0\u660e\u4e14\u65e0\u9ed8\u8ba4\u503c"}),(0,d.jsx)(n.td,{children:"\u7701\u7565\u5b57\u6bb5"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"NotSet"})})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"partialmodel-\u8f6c-activemodel",children:"PartialModel \u8f6c ActiveModel"}),"\n",(0,d.jsx)(n.admonition,{type:"tip",children:(0,d.jsxs)(n.mdxAdmonitionTitle,{children:["Since ",(0,d.jsx)(n.code,{children:"1.1.0"})]})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"DerivePartialModel"})," \u4e5f\u53ef\u4ee5\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"into_active_model"})," \u5c5e\u6027\u6d3e\u751f ",(0,d.jsx)(n.code,{children:"IntoActiveModel"}),"\u3002\u8fd9\u53ef\u4ee5\u590d\u7528\u4f60\u7684 partial select \u7ed3\u6784\u4f53\u8fdb\u884c\u5199\u5165\uff1a\u7f3a\u5931\u7684\u5b57\u6bb5\u53d8\u4e3a ",(0,d.jsx)(n.code,{children:"NotSet"}),"\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-rust",children:'#[derive(DerivePartialModel)]\n#[sea_orm(entity = "cake::Entity", into_active_model)]\nstruct PartialCake {\n    id: i32,\n    name: String,\n}\n\nlet partial_cake = PartialCake {\n    id: 12,\n    name: "Lemon Drizzle".to_owned(),\n};\n\nassert_eq!(\n    cake::ActiveModel {\n        ..partial_cake.into_active_model()\n    },\n    cake::ActiveModel {\n        id: Set(12),\n        name: Set("Lemon Drizzle".to_owned()),\n        ..Default::default()\n    }\n);\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u5f53 API \u7aef\u70b9\u63a5\u6536\u5b57\u6bb5\u5b50\u96c6\uff0c\u5e76\u5e0c\u671b\u4f7f\u7528\u540c\u4e00\u7ed3\u6784\u4f53\u8fdb\u884c\u67e5\u8be2\u548c\u66f4\u65b0\u65f6\uff0c\u8fd9\u5f88\u6709\u7528\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}}}]);