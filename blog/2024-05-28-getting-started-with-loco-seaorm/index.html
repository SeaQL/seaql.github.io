<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Getting Started with Loco &amp; SeaORM | SeaQL</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.sea-ql.org/blog/2024-05-28-getting-started-with-loco-seaorm/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="rust, orm, SeaORM, SeaQuery, SeaSchema, Seaography, StarfishQL, database, sql, mysql, sqlite, postgresql, rocket, tokio, sqlx, actix, async-std"><meta data-rh="true" property="og:title" content="Getting Started with Loco &amp; SeaORM | SeaQL"><meta data-rh="true" name="description" content="In this tutorial, we would create a REST notepad backend starting from scratch and adding a new REST endpoint to handle file uploads in Loco."><meta data-rh="true" property="og:description" content="In this tutorial, we would create a REST notepad backend starting from scratch and adding a new REST endpoint to handle file uploads in Loco."><meta data-rh="true" property="og:image" content="https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM.png"><meta data-rh="true" name="twitter:image" content="https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-05-28T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/billy1624"><meta data-rh="true" property="article:tag" content="news"><link data-rh="true" rel="icon" href="/blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.sea-ql.org/blog/2024-05-28-getting-started-with-loco-seaorm/"><link data-rh="true" rel="alternate" href="https://www.sea-ql.org/blog/2024-05-28-getting-started-with-loco-seaorm/" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.sea-ql.org/blog/2024-05-28-getting-started-with-loco-seaorm/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SLLZ32J41K-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://www.sea-ql.org/blog/2024-05-28-getting-started-with-loco-seaorm","mainEntityOfPage":"https://www.sea-ql.org/blog/2024-05-28-getting-started-with-loco-seaorm","url":"https://www.sea-ql.org/blog/2024-05-28-getting-started-with-loco-seaorm","headline":"Getting Started with Loco & SeaORM","name":"Getting Started with Loco & SeaORM","description":"In this tutorial, we would create a REST notepad backend starting from scratch and adding a new REST endpoint to handle file uploads in Loco.","datePublished":"2024-05-28T00:00:00.000Z","author":{"@type":"Person","name":"Billy Chan","description":"SeaQL Team","url":"https://github.com/billy1624","image":"https://avatars.githubusercontent.com/u/30400950?v=4"},"image":{"@type":"ImageObject","@id":"https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM.png","url":"https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM.png","contentUrl":"https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM.png","caption":"title image for the blog post: Getting Started with Loco & SeaORM"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://www.sea-ql.org/blog/","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SeaQL RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SeaQL Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="SeaQL" href="/blog/opensearch.xml">

<link rel="stylesheet" href="/cookieconsent/cookieconsent.css">
<script src="/sea-ql.js"></script>
<script type="module" src="/cookieconsent/cookieconsent.js" async></script><link rel="stylesheet" href="/blog/assets/css/styles.fec6f6f8.css">
<script src="/blog/assets/js/runtime~main.123b74bc.js" defer="defer"></script>
<script src="/blog/assets/js/main.0fbd7bb9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/blog/img/SeaQL.png"><link rel="preload" as="image" href="https://avatars.githubusercontent.com/u/30400950?v=4"><link rel="preload" as="image" href="/blog/img/Loco%20x%20SeaORM.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_jJMk" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.sea-ql.org" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/blog/img/SeaQL.png" alt="SeaQL Logo" class="themedComponent_ScW9 themedComponent--light_SiUE"><img src="/blog/img/SeaQL.png" alt="SeaQL Logo" class="themedComponent_ScW9 themedComponent--dark_l9XK"></div><b class="navbar__title text--truncate">SeaQL</b></a><a href="https://www.sea-ql.org/blog/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/SeaQL" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_jmIy colorModeToggle_JVcr"><button class="clean-btn toggleButton_kaPF toggleButtonDisabled_cVZq" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_wS5t lightToggleIcon_pyQD"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_wS5t darkToggleIcon_r7Lf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_wS5t systemToggleIcon_vpU9"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_U0UZ"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_Dpm9"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_S4B3 thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_mPOM margin-bottom--md">All Posts</div><div role="group"><h3 class="yearGroupHeading_hSsj">2025</h3><ul class="sidebarItemList_Tvcn clean-list"><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-10-08-seaography/">Seaography 2.0: A Powerful and Extensible GraphQL Framework</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-09-30-sea-orm-rbac/">Role Based Access Control in SeaORM 2.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-09-24-sea-orm-2.0/">SeaORM 2.0: A closer look</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-09-16-sea-orm-2.0/">A Sneak Peek at SeaORM 2.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-08-30-sea-query-1.0/">The road to SeaQuery 1.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-08-15-sea-query-raw-sql/">SeaQuery just made writing raw SQL more enjoyable</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-06-01-whats-new-in-sea-orm-1.1/">What&#x27;s new in SeaORM 1.1.12</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-03-08-whats-new-in-sea-orm-1.1/">What&#x27;s new in SeaORM 1.1.7</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-01-08-sea-orm-inheritance/">Tutorial: Modeling Inheritance in SeaORM</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2025-01-02-community-survey-2024/">SeaQL Community Survey 2024 Results</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_hSsj">2024</h3><ul class="sidebarItemList_Tvcn clean-list"><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-12-03-whats-new-in-seaquery-0.32.x/">What&#x27;s new in SeaQuery 0.32.x</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-11-30-whats-new-in-sea-streamer-0.5/">What&#x27;s new in SeaStreamer 0.5</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-08-08-graphql-admin-dashboard-with-loco-seaography/">GraphQL based Admin Dashboard with Loco and Seaography</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-08-04-sea-orm-1.0/">Announcing SeaORM 1.0 🐚</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-07-01-graphql-support-with-loco-seaography/">Adding GraphQL Support to Loco with Seaography</a></li><li class="sidebarItem_xLoW"><a aria-current="page" class="sidebarItemLink_kt61 sidebarItemLinkActive_Oh6C" href="/blog/2024-05-28-getting-started-with-loco-seaorm/">Getting Started with Loco &amp; SeaORM</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-05-20-async-rainbow-bridge/">The rainbow bridge between sync and async Rust</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-05-05-redis-kafka-data-sink/">Building a Redis / Kafka Data Sink</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-04-08-whats-new-in-seaorm-1.0-rc.x/">What&#x27;s new in SeaORM 1.0-rc.x</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-01-23-whats-new-in-seaorm-0.12.x/">What&#x27;s new in SeaORM 0.12.x</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2024-01-18-community-survey-2023/">SeaQL Community Survey 2023 Results</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_hSsj">2023</h3><ul class="sidebarItemList_Tvcn clean-list"><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2023-11-25-openuk-award/">OpenUK Award 2023 🏆</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2023-11-22-async-runtime-generic/">Writing Async Runtime Generic Library</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2023-09-06-whats-new-in-sea-streamer-0.3/">What&#x27;s new in SeaStreamer 0.3</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2023-08-12-announcing-seaorm-0.12/">Announcing SeaORM 0.12</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2023-04-03-intro-sea-streamer/">Introducing SeaStreamer 🌊</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2023-02-08-whats-new-in-seaorm-0.11.0/">What&#x27;s new in SeaORM 0.11.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2023-02-05-faq-02/">SeaORM FAQ.02</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2023-01-28-internship-at-seaql/">Internship @ SeaQL</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2023-01-01-call-for-contributors-n-reviewers/">Call for Contributors and Reviewers 📢</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_hSsj">2022</h3><ul class="sidebarItemList_Tvcn clean-list"><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-12-30-whats-new-in-seaquery-0.28.0/">What&#x27;s new in SeaQuery 0.28.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-12-02-whats-new-in-seaography-0.3.0/">What&#x27;s new in Seaography 0.3.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-11-10-whats-new-in-0.10.x/">What&#x27;s new in SeaORM 0.10.x</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-11-09-toggle-stacked-download-graph-in-crates-io/">Toggle Stacked Download Graph in crates.io</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-10-31-whats-new-in-seaquery-0.27.0/">What&#x27;s new in SeaQuery 0.27.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-09-27-getting-started-with-seaography/">Getting Started with Seaography</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-09-17-introducing-seaography/">Introducing Seaography 🧭</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-08-12-3k-github-stars/">Celebrating 3,000+ GitHub Stars 🎉</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-08-05-whats-new-in-seaquery-0.26.0/">What&#x27;s new in SeaQuery 0.26.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-07-30-engineering/">Engineering at SeaQL.org</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-07-17-whats-new-in-0.9.0/">What&#x27;s new in SeaORM 0.9.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-06-02-summer-of-code-2022-intro/">Welcome Summer of Code 2022 Contributors</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-05-15-whats-new-in-0.8.0/">What&#x27;s new in SeaORM 0.8.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-05-14-faq-01/">SeaORM FAQ.01</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-04-04-introducing-starfish-ql/">Introducing StarfishQL</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-03-26-whats-new-in-0.7.0/">What&#x27;s new in SeaORM 0.7.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/gsoc-2022/">Google Summer of Code 2022</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-02-07-whats-new-in-0.6.0/">What&#x27;s new in SeaORM 0.6.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2022-01-01-whats-new-in-0.5.0/">What&#x27;s new in SeaORM 0.5.0</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_hSsj">2021</h3><ul class="sidebarItemList_Tvcn clean-list"><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2021-11-19-whats-new-in-0.4.0/">What&#x27;s new in SeaORM 0.4.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2021-10-15-whats-new-in-0.3.0/">What&#x27;s new in SeaORM 0.3.0</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2021-10-01-whats-new-in-0.2.4/">What&#x27;s new in SeaORM 0.2.4</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2021-09-20-introducing-sea-orm/">Introducing SeaORM 🐚</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2021-08-30-release-model/">Release Model</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2021-08-07-hello-world/">Hello World</a></li><li class="sidebarItem_xLoW"><a class="sidebarItemLink_kt61" href="/blog/2021-07-01-welcome/">Welcome to SeaQL</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title__Ct8">Getting Started with Loco &amp; SeaORM</h1><div class="container_ZncM margin-vert--md"><time datetime="2024-05-28T00:00:00.000Z">May 28, 2024</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_eEfX"><div class="avatar margin-bottom--sm"><a href="https://github.com/billy1624" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_SoRt" src="https://avatars.githubusercontent.com/u/30400950?v=4" alt="Billy Chan"></a><div class="avatar__intro authorDetails_WCCs"><div class="avatar__name"><a href="https://github.com/billy1624" target="_blank" rel="noopener noreferrer"><span class="authorName_P0KK">Billy Chan</span></a></div><small class="authorTitle_Bc8n" title="SeaQL Team">SeaQL Team</small><div class="authorSocials_E2Rt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><img src="/blog/img/Loco%20x%20SeaORM.png">
<p>In this tutorial, we would create a REST notepad backend starting from scratch and adding a new REST endpoint to handle file uploads in Loco.</p>
<p>The full source code can be found <a href="https://github.com/SeaQL/sea-orm/tree/master/examples/loco_starter" target="_blank" rel="noopener noreferrer">here</a>. The documentation of the REST API is available <a href="https://documenter.getpostman.com/view/34752358/2sA3QmEF5q" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_y3jX" id="what-is-loco">What is Loco?<a href="#what-is-loco" class="hash-link" aria-label="Direct link to What is Loco?" title="Direct link to What is Loco?">​</a></h2>
<p><a href="https://loco.rs/" target="_blank" rel="noopener noreferrer">Loco</a> is a Rails inspired web framework for Rust. It includes many Rails feature with Rust ergonomics. Loco integrates seamlessly with SeaORM, offering a first-class development experience!</p>
<ul>
<li>Controllers and routing via <a href="https://github.com/tokio-rs/axum" target="_blank" rel="noopener noreferrer">axum</a></li>
<li>Models, migration, and ActiveRecord via <a href="https://www.sea-ql.org/SeaORM/" target="_blank" rel="noopener noreferrer">SeaORM</a></li>
<li>Views via <a href="https://serde.rs/json.html" target="_blank" rel="noopener noreferrer">serde</a></li>
<li>Seamless, Background jobs via <a href="https://github.com/film42/sidekiq-rs" target="_blank" rel="noopener noreferrer">sidekiq-rs</a>, multi modal: in process, out of process, async via Tokio</li>
<li><a href="https://loco.rs/blog/hello-world/" target="_blank" rel="noopener noreferrer">...and more</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_y3jX" id="rest-api-starter-template">REST API Starter Template<a href="#rest-api-starter-template" class="hash-link" aria-label="Direct link to REST API Starter Template" title="Direct link to REST API Starter Template">​</a></h2>
<p>Install <code>loco-cli</code>:</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token function" style="color:#79b6f2">cargo</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">install</span><span class="token plain"> loco-cli</span><br></span></code></pre></div></div>
<p>The <code>loco-cli</code> provides three starter templates:</p>
<ul>
<li>SaaS Starter</li>
<li>Rest API Starter</li>
<li>Lightweight Service Starter</li>
</ul>
<p>For this tutorial, we want the &quot;Rest API Starter&quot; template:</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ loco new</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">✔  You are inside a </span><span class="token function" style="color:#79b6f2">git</span><span class="token plain"> repository. Do you wish to continue? · Yes</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">✔  App name? · loco_starter</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">✔  What would you like to build? · Rest API </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">with DB and user auth</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">🚂 Loco app generated successfully in:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">/sea-orm/examples/loco_starter</span><br></span></code></pre></div></div>
<p>Next, we need to setup our PostgreSQL database.</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token function" style="color:#79b6f2">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#d7deea">-d</span><span class="token plain"> </span><span class="token parameter variable" style="color:#d7deea">-p</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5432</span><span class="token plain">:5432 </span><span class="token parameter variable" style="color:#d7deea">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">POSTGRES_USER</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">loco </span><span class="token parameter variable" style="color:#d7deea">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">POSTGRES_DB</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">loco_starter_development </span><span class="token parameter variable" style="color:#d7deea">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">POSTGRES_PASSWORD</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;loco&quot;</span><span class="token plain"> postgres:15.3-alpine</span><br></span></code></pre></div></div>
<p>If you want to use MySQL or SQLite as the database. Please update the <code>database.uri</code> configuration in <code>loco_starter/config/development.yaml</code>. And enable the corresponding database backend feature flag of SeaORM in <code>loco_starter/Cargo.toml</code>.</p>
<p>Now, start our REST application:</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">cargo</span><span class="token plain"> loco start</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Finished </span><span class="token variable" style="color:#d7deea">`</span><span class="token variable" style="color:#d7deea">dev</span><span class="token variable" style="color:#d7deea">`</span><span class="token plain"> profile </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">unoptimized + debuginfo</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> target</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> 1m 42s</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">     Running </span><span class="token variable" style="color:#d7deea">`</span><span class="token variable" style="color:#d7deea">target/debug/loco_starter-cli start</span><span class="token variable" style="color:#d7deea">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.724350Z  INFO app: loco_rs::config: loading environment from </span><span class="token assign-left variable" style="color:#d7deea">selected_path</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;config/development.yaml&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.740338Z  WARN app: loco_rs::boot: pretty backtraces are enabled </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">this is great </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> development but has a runtime cost </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> production. disable with </span><span class="token variable" style="color:#d7deea">`</span><span class="token variable" style="color:#d7deea">logger.pretty_backtrace</span><span class="token variable" style="color:#d7deea">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">in</span><span class="token plain"> your config yaml</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.833747Z  INFO app: loco_rs::db: auto migrating </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.845983Z  INFO app: sea_orm_migration::migrator: Applying all pending migrations </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.850231Z  INFO app: sea_orm_migration::migrator: Applying migration </span><span class="token string" style="color:#8dc891">&#x27;m20220101_000001_users&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.864095Z  INFO app: sea_orm_migration::migrator: Migration </span><span class="token string" style="color:#8dc891">&#x27;m20220101_000001_users&#x27;</span><span class="token plain"> has been applied </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.865799Z  INFO app: sea_orm_migration::migrator: Applying migration </span><span class="token string" style="color:#8dc891">&#x27;m20231103_114510_notes&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.873653Z  INFO app: sea_orm_migration::migrator: Migration </span><span class="token string" style="color:#8dc891">&#x27;m20231103_114510_notes&#x27;</span><span class="token plain"> has been applied </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.875645Z  INFO app: loco_rs::boot: initializers loaded </span><span class="token assign-left variable" style="color:#d7deea">initializers</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906072Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">GET</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/_ping </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906176Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">GET</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/_health </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906264Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">GET</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/notes </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906335Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">POST</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/notes </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906414Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">GET</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/notes/:id </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906501Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">DELETE</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/notes/:id </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906558Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">POST</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/notes/:id </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906609Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">POST</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/auth/register </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906680Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">POST</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/auth/verify </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906753Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">POST</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/auth/login </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906838Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">POST</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/auth/forgot </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.906931Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">POST</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/auth/reset </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.907012Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">GET</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> /api/user/current </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.907309Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">Middleware</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Adding limit payload </span><span class="token assign-left variable" style="color:#d7deea">data</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;5mb&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.907440Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">Middleware</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Adding log trace </span><span class="token function" style="color:#79b6f2">id</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.907714Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">Middleware</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Adding cors </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T06:56:42.907788Z  INFO app: loco_rs::controller::app_routes: </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">Middleware</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> Adding etag layer </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                      ▄     ▀</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                                 ▀  ▄</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                  ▄       ▀     ▄  ▄ ▄▀</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                                    ▄ ▀▄▄</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                        ▄     ▀    ▀  ▀▄▀█▄</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                                          ▀█▄</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄▄   ▄▄▄▄▄▄▄▄▄▄▄ ▄▄▄▄▄▄▄▄▄ ▀▀█</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> ██████  █████   ███ █████   ███ █████   ███ ▀█</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> ██████  █████   ███ █████   ▀▀▀ █████   ███ ▄█▄</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> ██████  █████   ███ █████       █████   ███ ████▄</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> ██████  █████   ███ █████   ▄▄▄ █████   ███ █████</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> ██████  █████   ███  ████   ███ █████   ███ ████▀</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   ▀▀▀██▄ ▀▀▀▀▀▀▀▀▀▀  ▀▀▀▀▀▀▀▀▀▀  ▀▀▀▀▀▀▀▀▀▀ ██▀</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">       ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                https://loco.rs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">environment: development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   database: automigrate</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">     logger: debug</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">compilation: debug</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      modes: server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">listening on </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">::</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">:3000</span><br></span></code></pre></div></div>
<p>From the log messages printed above, we saw:</p>
<ul>
<li>Database migrations have been applied</li>
<li>All available REST API</li>
</ul>
<p>To check if the application listen for requests:</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#d7deea">--location</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:3000/api/_ping&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;ok&quot;</span><span class="token plain">:true</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_y3jX" id="user-management">User Management<a href="#user-management" class="hash-link" aria-label="Direct link to User Management" title="Direct link to User Management">​</a></h2>
<p>The starter template comes with a basic user management module.</p>
<h3 class="anchor anchorWithStickyNavbar_y3jX" id="registration">Registration<a href="#registration" class="hash-link" aria-label="Direct link to Registration" title="Direct link to Registration">​</a></h3>
<p>It is a common practice to send a verification email to the provided email. However, that would requires a SMTP server and this is not the focus of this blog post. So, I will skip the email verification:</p>
<div class="language-diff codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/src/controllers/auth.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-diff codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">#[debug_handler]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">async fn register(</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    State(ctx): State&lt;AppContext&gt;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Json(params): Json&lt;RegisterParams&gt;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">) -&gt; Result&lt;Response&gt; {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    let res = users::Model::create_with_password(&amp;ctx.db, &amp;params).await;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    let user = match res {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        Ok(user) =&gt; user,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        Err(err) =&gt; {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            tracing::info!(</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                message = err.to_string(),</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                user_email = &amp;params.email,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;could not register user&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            );</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            return format::json(());</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+   // Skip email verification, all new registrations are considered verified</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+   let _user = user</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+       .into_active_model()</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+       .verified(&amp;ctx.db)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+       .await?;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+   // Skip sending verification email as we don&#x27;t have a mail server</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+   /*</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    let user = user</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        .into_active_model()</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        .set_email_verification_sent(&amp;ctx.db)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        .await?;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    AuthMailer::send_welcome(&amp;ctx, &amp;user).await?;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+   */</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    format::json(())</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Compile and run the application, then register a new user account:</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#d7deea">--location</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:3000/api/auth/register&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">--data-raw </span><span class="token string" style="color:#8dc891">&#x27;{</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">    &quot;name&quot;: &quot;Billy&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">    &quot;email&quot;: &quot;cwchan.billy@gmail.com&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">    &quot;password&quot;: &quot;password&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">null</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_y3jX" id="login">Login<a href="#login" class="hash-link" aria-label="Direct link to Login" title="Direct link to Login">​</a></h3>
<p>You should see there is a new row of <code>user</code> in the database.</p>
<p>Next, we login the user account with the corresponding email and password:</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#d7deea">--location</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:3000/api/auth/login&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">--data-raw </span><span class="token string" style="color:#8dc891">&#x27;{</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">    &quot;email&quot;: &quot;cwchan.billy@gmail.com&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">    &quot;password&quot;: &quot;password&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;token&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;pid&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;11d01af3-6fe2-44f3-89f0-c02cec39741d&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;name&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Billy&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;is_verified&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_y3jX" id="authentication">Authentication<a href="#authentication" class="hash-link" aria-label="Direct link to Authentication" title="Direct link to Authentication">​</a></h3>
<p>The JWT token above will be used in user authentication. You must set the <code>Authorization</code> header to access any REST endpoint that requires user login.</p>
<p>For example, fetching the user info of the current user:</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#d7deea">--location</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:3000/api/user/current&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token parameter variable" style="color:#d7deea">--header</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;pid&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">&quot;11d01af3-6fe2-44f3-89f0-c02cec39741d&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;name&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">&quot;Billy&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;email&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">&quot;cwchan.billy@gmail.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_y3jX" id="handling-rest-requests">Handling REST Requests<a href="#handling-rest-requests" class="hash-link" aria-label="Direct link to Handling REST Requests" title="Direct link to Handling REST Requests">​</a></h2>
<p>The starter application comes with a notes controller for the <code>notes</code> table.</p>
<h3 class="anchor anchorWithStickyNavbar_y3jX" id="create-notes">Create Notes<a href="#create-notes" class="hash-link" aria-label="Direct link to Create Notes" title="Direct link to Create Notes">​</a></h3>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#d7deea">--location</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:3000/api/notes&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token parameter variable" style="color:#d7deea">--header</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token parameter variable" style="color:#d7deea">--data</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;{</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">    &quot;title&quot;: &quot;Getting Started with Loco &amp; SeaORM&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">    &quot;content&quot;: &quot;In this tutorial, we would create an REST notepad backend starting from scratch and adding a new REST endpoint to handle file uploads.&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token string" style="color:#8dc891">}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;created_at&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2024-05-20T08:43:45.408449&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;updated_at&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2024-05-20T08:43:45.408449&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;id&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;title&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Getting Started with Loco &amp; SeaORM&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;content&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;In this tutorial, we would create an REST notepad backend starting from scratch and adding a new REST endpoint to handle file uploads.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_y3jX" id="list-notes">List Notes<a href="#list-notes" class="hash-link" aria-label="Direct link to List Notes" title="Direct link to List Notes">​</a></h3>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#d7deea">--location</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:3000/api/notes&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token parameter variable" style="color:#d7deea">--header</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;created_at&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2024-05-20T08:43:45.408449&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;updated_at&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2024-05-20T08:43:45.408449&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;id&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;title&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Getting Started with Loco &amp; SeaORM&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;content&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;In this tutorial, we would create an REST notepad backend starting from scratch and adding a new REST endpoint to handle file uploads.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;created_at&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2024-05-20T08:45:38.973130&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;updated_at&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2024-05-20T08:45:38.973130&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;id&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;title&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Introducing SeaORM X&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;content&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;SeaORM X is built on top of SeaORM with support for SQL Server&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_y3jX" id="get-notes">Get Notes<a href="#get-notes" class="hash-link" aria-label="Direct link to Get Notes" title="Direct link to Get Notes">​</a></h3>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#d7deea">--location</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;http://localhost:3000/api/notes/2&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token parameter variable" style="color:#d7deea">--header</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;created_at&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2024-05-20T08:45:38.973130&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;updated_at&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;2024-05-20T08:45:38.973130&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;id&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;title&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Introducing SeaORM X&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token string" style="color:#8dc891">&quot;content&quot;</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;SeaORM X is built on top of SeaORM with support for SQL Server&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_y3jX" id="handling-file-uploads">Handling File Uploads<a href="#handling-file-uploads" class="hash-link" aria-label="Direct link to Handling File Uploads" title="Direct link to Handling File Uploads">​</a></h2>
<p>Next, we will add a file upload feature where user can upload files that is related to the notes.</p>
<h3 class="anchor anchorWithStickyNavbar_y3jX" id="file-table-migration">File Table Migration<a href="#file-table-migration" class="hash-link" aria-label="Direct link to File Table Migration" title="Direct link to File Table Migration">​</a></h3>
<p>Create a migration file for the new <code>files</code> table. Each row of <code>files</code> reference a specific <code>notes</code> in the database.</p>
<div class="language-rust codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/migration/src/m20240520_173001_files.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-rust codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">sea_orm_migration</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token namespace" style="opacity:0.7">prelude</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token operator" style="color:#d7deea">*</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">schema</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token operator" style="color:#d7deea">*</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">use</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">super</span><span class="token module-declaration namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token module-declaration namespace" style="opacity:0.7">m20231103_114510_notes</span><span class="token module-declaration namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Notes</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c5a5c5">#[derive(DeriveMigrationName)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#FAC863">Migration</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c5a5c5">#[async_trait::async_trait]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">impl</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MigrationTrait</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Migration</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">async</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">up</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token keyword" style="color:#c5a5c5">self</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> manager</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token class-name" style="color:#FAC863">SchemaManager</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Result</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">DbErr</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        manager</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">create_table</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token function" style="color:#79b6f2">table_auto</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Files</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Table</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">col</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token function" style="color:#79b6f2">pk_auto</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Files</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">col</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token function" style="color:#79b6f2">integer</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Files</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">NotesId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">col</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token function" style="color:#79b6f2">string</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Files</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">FilePath</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">foreign_key</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                        </span><span class="token class-name" style="color:#FAC863">ForeignKey</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">create</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">name</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;FK_files_notes_id&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">from</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Files</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Table</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Files</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">NotesId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">to</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Notes</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Table</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Notes</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">to_owned</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">async</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">down</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token keyword" style="color:#c5a5c5">self</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> manager</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token class-name" style="color:#FAC863">SchemaManager</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Result</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">DbErr</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        manager</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">drop_table</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Table</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">drop</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">table</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Files</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Table</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">to_owned</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c5a5c5">#[derive(DeriveIden)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">enum</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#FAC863">Files</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">Table</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">Id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">NotesId</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">FilePath</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<p>Then, we need to enable the new migration.</p>
<div class="language-diff codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/migration/src/lib.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-diff codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">#![allow(elided_lifetimes_in_paths)]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">#![allow(clippy::wildcard_imports)]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">pub use sea_orm_migration::prelude::*;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">mod m20220101_000001_users;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">mod m20231103_114510_notes;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+ mod m20240520_173001_files;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">pub struct Migrator;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">#[async_trait::async_trait]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">impl MigratorTrait for Migrator {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    fn migrations() -&gt; Vec&lt;Box&lt;dyn MigrationTrait&gt;&gt; {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        vec![</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            Box::new(m20220101_000001_users::Migration),</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            Box::new(m20231103_114510_notes::Migration),</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+           Box::new(m20240520_173001_files::Migration),</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Compile and start the application, it should run our new migration on startup.</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">$ </span><span class="token function" style="color:#79b6f2">cargo</span><span class="token plain"> loco start</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T09:39:59.607525Z  INFO app: loco_rs::db: auto migrating </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T09:39:59.611997Z  INFO app: sea_orm_migration::migrator: Applying all pending migrations </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T09:39:59.621699Z  INFO app: sea_orm_migration::migrator: Applying migration </span><span class="token string" style="color:#8dc891">&#x27;m20240520_173001_files&#x27;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2024</span><span class="token plain">-05-20T09:39:59.643886Z  INFO app: sea_orm_migration::migrator: Migration </span><span class="token string" style="color:#8dc891">&#x27;m20240520_173001_files&#x27;</span><span class="token plain"> has been applied </span><span class="token assign-left variable" style="color:#d7deea">environment</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_y3jX" id="file-model-definition">File Model Definition<a href="#file-model-definition" class="hash-link" aria-label="Direct link to File Model Definition" title="Direct link to File Model Definition">​</a></h3>
<p>Define <code>files</code> entity model.</p>
<div class="language-rust codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/src/models/_entities/files.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-rust codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">sea_orm</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token namespace" style="opacity:0.7">entity</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token namespace" style="opacity:0.7">prelude</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token operator" style="color:#d7deea">*</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">serde</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token class-name" style="color:#FAC863">Deserialize</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Serialize</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c5a5c5">#[derive(Clone, Debug, PartialEq, DeriveEntityModel, Eq, Serialize, Deserialize)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c5a5c5">#[sea_orm(table_name = </span><span class="token attribute attr-name string" style="color:#8dc891">&quot;files&quot;</span><span class="token attribute attr-name" style="color:#c5a5c5">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#FAC863">Model</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> created_at</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">DateTime</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> updated_at</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">DateTime</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#c5a5c5">#[sea_orm(primary_key)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">i32</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> notes_id</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">i32</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token attribute attr-name" style="color:#c5a5c5">#[derive(Copy, Clone, Debug, EnumIter, DeriveRelation)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">enum</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#FAC863">Relation</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token attribute attr-name" style="color:#c5a5c5">#[sea_orm(</span><br></span><span class="token-line" style="color:#ffffff"><span class="token attribute attr-name" style="color:#c5a5c5">        belongs_to = </span><span class="token attribute attr-name string" style="color:#8dc891">&quot;super::notes::Entity&quot;</span><span class="token attribute attr-name" style="color:#c5a5c5">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token attribute attr-name" style="color:#c5a5c5">        from = </span><span class="token attribute attr-name string" style="color:#8dc891">&quot;Column::NotesId&quot;</span><span class="token attribute attr-name" style="color:#c5a5c5">,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token attribute attr-name" style="color:#c5a5c5">        to = </span><span class="token attribute attr-name string" style="color:#8dc891">&quot;super::notes::Column::Id&quot;</span><span class="token attribute attr-name" style="color:#c5a5c5"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token attribute attr-name" style="color:#c5a5c5">    )]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">Notes</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">impl</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Related</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token keyword" style="color:#c5a5c5">super</span><span class="token module-declaration namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token module-declaration namespace" style="opacity:0.7">notes</span><span class="token module-declaration namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Entity</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Entity</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">to</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RelationDef</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">Relation</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Notes</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">def</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<p>Implement the <code>ActiveModelBehavior</code> in the parent module.</p>
<div class="language-rust codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/src/models/files.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-rust codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">sea_orm</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token namespace" style="opacity:0.7">entity</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token namespace" style="opacity:0.7">prelude</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token operator" style="color:#d7deea">*</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">use</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">super</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token plain">_entities</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token namespace" style="opacity:0.7">files</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">ActiveModel</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">impl</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ActiveModelBehavior</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ActiveModel</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// extend activemodel below (keep comment for generators)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_y3jX" id="file-controller">File Controller<a href="#file-controller" class="hash-link" aria-label="Direct link to File Controller" title="Direct link to File Controller">​</a></h3>
<p>Controller is where we handle the file uploading, listing and viewing.</p>
<h4 class="anchor anchorWithStickyNavbar_y3jX" id="upload-file">Upload File<a href="#upload-file" class="hash-link" aria-label="Direct link to Upload File" title="Direct link to Upload File">​</a></h4>
<p>The following upload handler allows multiple files to be uploaded in a single POST request.</p>
<div class="language-rust codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/src/controllers/files.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-rust codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token attribute attr-name" style="color:#c5a5c5">#[debug_handler]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">async</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">upload</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    _auth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">auth</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token constant" style="color:#5a9bcf">JWT</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">Path</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">notes_id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Path</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token keyword" style="color:#c5a5c5">i32</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">State</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">State</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token class-name" style="color:#FAC863">AppContext</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">mut</span><span class="token plain"> multipart</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Multipart</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Result</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token class-name" style="color:#FAC863">Response</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Collect all uploaded files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">mut</span><span class="token plain"> files </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Vec</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">new</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Iterate all files in the POST body</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">while</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Some</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">field</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> multipart</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">next_field</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">map_err</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#8dc891">|</span><span class="token closure-params">err</span><span class="token closure-params closure-punctuation punctuation" style="color:#8dc891">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token namespace" style="opacity:0.7">tracing</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token macro property" style="color:#5a9bcf">error!</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">error </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">?</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">&quot;could not readd multipart&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">Error</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">BadRequest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;could not readd multipart&quot;</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">into</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token operator" style="color:#d7deea">?</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Get the file name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> file_name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">match</span><span class="token plain"> field</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">file_name</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token class-name" style="color:#FAC863">Some</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">file_name</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> file_name</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">to_string</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            _ </span><span class="token operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Err</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Error</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">BadRequest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;file name not found&quot;</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">into</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Get the file content as bytes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> content </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> field</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">bytes</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">map_err</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token closure-params closure-punctuation punctuation" style="color:#8dc891">|</span><span class="token closure-params">err</span><span class="token closure-params closure-punctuation punctuation" style="color:#8dc891">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">tracing</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token macro property" style="color:#5a9bcf">error!</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">error </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">?</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">&quot;could not readd bytes&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token class-name" style="color:#FAC863">Error</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">BadRequest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;could not readd bytes&quot;</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">into</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token operator" style="color:#d7deea">?</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Create a folder to store the uploaded file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> now </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">chrono</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token namespace" style="opacity:0.7">offset</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Local</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">now</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">format</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;%Y%m%d_%H%M%S&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">to_string</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> uuid </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">uuid</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Uuid</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">new_v4</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">to_string</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> folder </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token macro property" style="color:#5a9bcf">format!</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;{now}_{uuid}&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> upload_folder </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PathBuf</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">from</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token constant" style="color:#5a9bcf">UPLOAD_DIR</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">join</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">folder</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token namespace" style="opacity:0.7">fs</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token function" style="color:#79b6f2">create_dir_all</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">upload_folder</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token operator" style="color:#d7deea">?</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Write the file into the newly created folder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> path </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> upload_folder</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">join</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">file_name</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">mut</span><span class="token plain"> f </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">fs</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">OpenOptions</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">new</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">create_new</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token boolean" style="color:#ff8b50">true</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">write</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token boolean" style="color:#ff8b50">true</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">open</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">path</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token operator" style="color:#d7deea">?</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        f</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">write_all</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">content</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token operator" style="color:#d7deea">?</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        f</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">flush</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token operator" style="color:#d7deea">?</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Record the file upload in database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> file </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">files</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">ActiveModel</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            notes_id</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ActiveValue</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">notes_id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            file_path</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ActiveValue</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Set</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                path</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">strip_prefix</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token constant" style="color:#5a9bcf">UPLOAD_DIR</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">unwrap</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">to_str</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">unwrap</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">to_string</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">..</span><span class="token class-name" style="color:#FAC863">Default</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">default</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">insert</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">db</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token operator" style="color:#d7deea">?</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        files</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">push</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">file</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token namespace" style="opacity:0.7">format</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token function" style="color:#79b6f2">json</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">files</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<p>Try uploading multiple files in a single POST request:</p>
<p><img decoding="async" loading="lazy" src="https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM%20upload%20file.png" alt="" class="img_eI3S"></p>
<p>All uploaded files are saved into the <code>uploads</code> directory:</p>
<p><img decoding="async" loading="lazy" src="https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM%20upload%20directory.png" alt="" class="img_eI3S"></p>
<h4 class="anchor anchorWithStickyNavbar_y3jX" id="list-file">List File<a href="#list-file" class="hash-link" aria-label="Direct link to List File" title="Direct link to List File">​</a></h4>
<p>List all <code>files</code> that are related to a specific <code>notes_id</code>.</p>
<div class="language-rust codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/src/controllers/files.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-rust codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token attribute attr-name" style="color:#c5a5c5">#[debug_handler]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">async</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">list</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    _auth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">auth</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token constant" style="color:#5a9bcf">JWT</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">Path</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">notes_id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Path</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token keyword" style="color:#c5a5c5">i32</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">State</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">State</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token class-name" style="color:#FAC863">AppContext</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Result</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token class-name" style="color:#FAC863">Response</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Fetch all files uploaded for a specific notes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> files </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">files</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Entity</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">find</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">filter</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token namespace" style="opacity:0.7">files</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Column</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">NotesId</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">eq</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">notes_id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">order_by_asc</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token namespace" style="opacity:0.7">files</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Column</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">all</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">db</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token operator" style="color:#d7deea">?</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token namespace" style="opacity:0.7">format</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token function" style="color:#79b6f2">json</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">files</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM%20list%20file.png" alt="" class="img_eI3S"></p>
<h4 class="anchor anchorWithStickyNavbar_y3jX" id="view-file">View File<a href="#view-file" class="hash-link" aria-label="Direct link to View File" title="Direct link to View File">​</a></h4>
<p>View a specific <code>files</code>.</p>
<div class="language-rust codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/src/controllers/files.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-rust codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token attribute attr-name" style="color:#c5a5c5">#[debug_handler]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">async</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">view</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    _auth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">auth</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token constant" style="color:#5a9bcf">JWT</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">Path</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">files_id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Path</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token keyword" style="color:#c5a5c5">i32</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">State</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">State</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token class-name" style="color:#FAC863">AppContext</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Result</span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token class-name" style="color:#FAC863">Response</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Fetch the file info from database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> file </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">files</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">Entity</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">find_by_id</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">files_id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">one</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">db</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token operator" style="color:#d7deea">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;File not found&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Stream the file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> file </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">fs</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token class-name" style="color:#FAC863">File</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">open</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token macro property" style="color:#5a9bcf">format!</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;{UPLOAD_DIR}/{}&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> file</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">await</span><span class="token operator" style="color:#d7deea">?</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> stream </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ReaderStream</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">new</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">file</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">let</span><span class="token plain"> body </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Body</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">from_stream</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stream</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">Ok</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token namespace" style="opacity:0.7">format</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">::</span><span class="token function" style="color:#79b6f2">render</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">response</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">body</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">body</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token operator" style="color:#d7deea">?</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM%20view%20file.png" alt="" class="img_eI3S"></p>
<h4 class="anchor anchorWithStickyNavbar_y3jX" id="file-controller-routes">File Controller Routes<a href="#file-controller-routes" class="hash-link" aria-label="Direct link to File Controller Routes" title="Direct link to File Controller Routes">​</a></h4>
<p>Add our newly defined files handler to the application routes.</p>
<div class="language-rust codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/src/controllers/files.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-rust codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#79b6f2">routes</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">-&gt;</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Routes</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Bind the routes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">Routes</span><span class="token punctuation" style="color:#8dc891">::</span><span class="token function" style="color:#79b6f2">new</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">prefix</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;files&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">add</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;/upload/:notes_id&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">post</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">upload</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">add</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;/list/:notes_id&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">list</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">add</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;/view/:files_id&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">view</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<div class="language-diff codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/src/app.rs</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-diff codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">pub struct App;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">#[async_trait]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">impl Hooks for App {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    fn routes(_ctx: &amp;AppContext) -&gt; AppRoutes {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        AppRoutes::with_default_routes()</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            .prefix(&quot;/api&quot;)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            .add_route(controllers::notes::routes())</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            .add_route(controllers::auth::routes())</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            .add_route(controllers::user::routes())</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+           .add_route(controllers::files::routes())</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_y3jX" id="extra-rust-dependencies">Extra Rust Dependencies<a href="#extra-rust-dependencies" class="hash-link" aria-label="Direct link to Extra Rust Dependencies" title="Direct link to Extra Rust Dependencies">​</a></h4>
<p>Remember to enable <code>multipart</code> in <code>axum</code> and add <code>tokio-util</code> dependency.</p>
<div class="language-diff codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">loco_starter/Cargo.toml</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-diff codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token plain">- axum = &quot;0.7.1&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+ axum = { version = &quot;0.7.1&quot;, features = [&quot;multipart&quot;] }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">+ tokio-util = &quot;0.7.11&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_y3jX" id="sql-server-support">SQL Server Support<a href="#sql-server-support" class="hash-link" aria-label="Direct link to SQL Server Support" title="Direct link to SQL Server Support">​</a></h2>
<p><a href="https://www.sea-ql.org/SeaORM-X/" target="_blank" rel="noopener noreferrer">SQL Server for SeaORM</a> is now available as a closed beta. If you are interested, please signup <a href="https://forms.office.com/r/1MuRPJmYBR" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Migrating from <code>sea-orm</code> to <code>sea-orm-x</code> is straightforward with two simple steps. First, update the existing <code>sea-orm</code> dependency to <code>sea-orm-x</code> and enable the <code>sqlz-mssql</code> feature. Note that you might need to patch SeaORM dependency for the upstream dependencies.</p>
<div class="language-toml codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Pelq">Cargo.toml</div><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-toml codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token key property" style="color:#5a9bcf">sea-orm</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token key property" style="color:#5a9bcf">path</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&lt;SEA_ORM_X_ROOT&gt;/sea-orm-x&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token key property" style="color:#5a9bcf">features</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;runtime-async-std-rustls&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;sqlz-mssql&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key property" style="color:#5a9bcf">sea-orm-migration</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token key property" style="color:#5a9bcf">path</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&lt;SEA_ORM_X_ROOT&gt;/sea-orm-x/sea-orm-migration&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># Patch SeaORM dependency for the upstream dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">[</span><span class="token table class-name" style="color:#FAC863">patch.crates-io</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key property" style="color:#5a9bcf">sea-orm</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token key property" style="color:#5a9bcf">path</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&lt;SEA_ORM_X_ROOT&gt;/sea-orm-x&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key property" style="color:#5a9bcf">sea-orm-migration</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token key property" style="color:#5a9bcf">path</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&lt;SEA_ORM_X_ROOT&gt;/sea-orm-x/sea-orm-migration&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre></div></div>
<p>Second, update the connection string to connect to the MSSQL database.</p>
<div class="language-sh codeBlockContainer_uq2W theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_XEgh"><pre tabindex="0" class="prism-code language-sh codeBlock_iXnu thin-scrollbar" style="background-color:#282c34;color:#ffffff"><code class="codeBlockLines_wLjd"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># If the schema is `dbo`, simply write:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">mssql://username:password@host/database</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># Or, specify the schema name by providing an extra `currentSchema` query param.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">mssql://username:password@host/database?currentSchema</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">my_schema</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># You can trust peer certificate by providing an extra trustCertificate query param.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">mssql://username:password@host/database?trustCertificate</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">true</span><br></span></code></pre></div></div>
<p>SeaORM X has full Loco support and integrate seamlessly with many web frameworks:</p>
<ul>
<li>Actix</li>
<li>Axum</li>
<li>Async GraphQL</li>
<li>jsonrpsee</li>
<li>Loco</li>
<li>Poem</li>
<li>Salvo</li>
<li>Tonic</li>
</ul>
<p>Happy Coding!</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_GeQf padding--none margin-left--sm"><li class="tag_bwzm"><a rel="tag" class="tag_wbtT tagRegular_jBJs" href="/blog/tags/news/">news</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/SeaQL/seaql.github.io/edit/master/Blog/blog/2024-05-28-getting-started-with-loco-seaorm.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_GmOH" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_gR52"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2024-07-01-graphql-support-with-loco-seaography/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Adding GraphQL Support to Loco with Seaography</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2024-05-20-async-rainbow-bridge/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">The rainbow bridge between sync and async Rust</div></a></nav></main><div class="col col--2"><div class="tableOfContents_L31c thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-loco" class="table-of-contents__link toc-highlight">What is Loco?</a></li><li><a href="#rest-api-starter-template" class="table-of-contents__link toc-highlight">REST API Starter Template</a></li><li><a href="#user-management" class="table-of-contents__link toc-highlight">User Management</a><ul><li><a href="#registration" class="table-of-contents__link toc-highlight">Registration</a></li><li><a href="#login" class="table-of-contents__link toc-highlight">Login</a></li><li><a href="#authentication" class="table-of-contents__link toc-highlight">Authentication</a></li></ul></li><li><a href="#handling-rest-requests" class="table-of-contents__link toc-highlight">Handling REST Requests</a><ul><li><a href="#create-notes" class="table-of-contents__link toc-highlight">Create Notes</a></li><li><a href="#list-notes" class="table-of-contents__link toc-highlight">List Notes</a></li><li><a href="#get-notes" class="table-of-contents__link toc-highlight">Get Notes</a></li></ul></li><li><a href="#handling-file-uploads" class="table-of-contents__link toc-highlight">Handling File Uploads</a><ul><li><a href="#file-table-migration" class="table-of-contents__link toc-highlight">File Table Migration</a></li><li><a href="#file-model-definition" class="table-of-contents__link toc-highlight">File Model Definition</a></li><li><a href="#file-controller" class="table-of-contents__link toc-highlight">File Controller</a></li></ul></li><li><a href="#sql-server-support" class="table-of-contents__link toc-highlight">SQL Server Support</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/SeaQL" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://discord.com/invite/uCPdDXzbdv" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/sea_ql" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/sea-ql" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.sea-ql.org/SeaORM/" target="_blank" rel="noopener noreferrer" class="footer__link-item">SeaORM</a></li><li class="footer__item"><a href="https://github.com/SeaQL/sea-query" target="_blank" rel="noopener noreferrer" class="footer__link-item">SeaQuery</a></li><li class="footer__item"><a href="https://www.sea-ql.org/Seaography/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Seaography</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><br>SeaQL.org © 2025 🇬🇧</div></div></div></footer></div>
</body>
</html>